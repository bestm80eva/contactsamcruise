<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 56576</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="start-Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Startup routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="56064.html">56064</a></span></td>
<td class="up">Up: <a class="link" href="start.html#56576">Map</a></td>
<td class="next"><span class="next-0">Next: <a class="link" href=""></a></span></td>
</tr>
</table>
<div class="description">56576: Prepare the bottom 4 lines of the screen</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="../asm/61630.html">61630</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56576"></a>56576</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56577"></a>56577</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56578"></a>56578</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56579"></a>56579</td>
<td class="instruction">LD H,80</td>
<td class="comment-11" rowspan="9">Clear the bottom 4 lines (32 pixel rows) of the display file</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56581"></a>56581</td>
<td class="instruction">LD L,128</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56583"></a>56583</td>
<td class="instruction">XOR A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56584"></a>56584</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56585"></a>56585</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56586"></a>56586</td>
<td class="instruction">JR NZ,56584</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56588"></a>56588</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56589"></a>56589</td>
<td class="instruction">BIT 3,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56591"></a>56591</td>
<td class="instruction">JR Z,56581</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="56593"></a>
<div class="comments">
<div class="paragraph">
Now the first 24 character squares on each of the bottom 3 lines (24 pixel rows) of the screen are filled with graphic data. The 576 bytes of graphic data are copied to the screen from the following 5 segments:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th colspan="1" rowspan="1">Address</th>
<th colspan="1" rowspan="1">Length</th>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a class="link" href="55040.html">55040</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a class="link" href="55296.html">55296</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a class="link" href="55552.html">55552</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a class="link" href="55808.html">55808</a></td>
<td class="" colspan="1" rowspan="1">126 bytes</td>
</tr>
<tr>
<td class="centre" colspan="1" rowspan="1"><a class="link" href="56064.html">56064</a></td>
<td class="" colspan="1" rowspan="1">72 bytes</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56593"></a>56593</td>
<td class="instruction">LD HL,55040</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first byte to be copied to the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56596"></a>56596</td>
<td class="instruction">LD DE,20640</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the first display file location to be written</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56599"></a>56599</td>
<td class="instruction">LD C,24</td>
<td class="comment-11" rowspan="1">There are 24 bytes per row of pixels</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56601"></a>56601</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">Save the display file pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56602"></a>56602</td>
<td class="instruction">LD B,24</td>
<td class="comment-11" rowspan="1">There are 24 rows of pixels to be drawn</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56604"></a>56604</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick up a byte to copy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56605"></a>56605</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Copy the byte to the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56606"></a>56606</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Move <span class="register">HL</span> along to the next byte to copy</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56607"></a>56607</td>
<td class="instruction">LD A,L</td>
<td class="comment-11" rowspan="2">Have we reached the end of a segment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56608"></a>56608</td>
<td class="instruction">SUB 126</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56610"></a>56610</td>
<td class="instruction">JR NZ,56614</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56612"></a>56612</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the first byte in the next segment</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56613"></a>56613</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56614"></a>56614</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the next pixel row down on the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56615"></a>56615</td>
<td class="instruction">BIT 3,D</td>
<td class="comment-11" rowspan="1">Have we just copied a byte to the 8th or 16th row of pixels?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56617"></a>56617</td>
<td class="instruction">JR Z,56625</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56619"></a>56619</td>
<td class="instruction">LD D,80</td>
<td class="comment-11" rowspan="4">Otherwise point <span class="register">DE</span> at the 9th or 17th row of pixels</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56621"></a>56621</td>
<td class="instruction">LD A,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56622"></a>56622</td>
<td class="instruction">ADD A,32</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56624"></a>56624</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56625"></a>56625</td>
<td class="instruction">DJNZ 56604</td>
<td class="comment-11" rowspan="1">Jump back until a column of 24 bytes has been copied</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56627"></a>56627</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore the display file pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56628"></a>56628</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the top byte in the next column along</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56629"></a>56629</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Have we finished all 24 columns?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56630"></a>56630</td>
<td class="instruction">JR NZ,56601</td>
<td class="comment-11" rowspan="1">Jump back if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="56632"></a>
<div class="comments">
<div class="paragraph">
Now that the bottom 4 lines of the display file are ready, it's time to prepare the bottom 4 lines of the attribute file.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56632"></a>56632</td>
<td class="instruction">LD HL,23168</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first attribute byte of the line where on-screen messages will be displayed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56635"></a>56635</td>
<td class="instruction">LD B,32</td>
<td class="comment-11" rowspan="1">There are 32 attribute bytes in this line</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56637"></a>56637</td>
<td class="instruction">LD (HL),15</td>
<td class="comment-11" rowspan="3">Set each attribute byte to 15 (INK 7: PAPER 1)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56639"></a>56639</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56640"></a>56640</td>
<td class="instruction">DJNZ 56637</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56642"></a>56642</td>
<td class="instruction">LD C,3</td>
<td class="comment-11" rowspan="1">There are 3 lines at the bottom of the screen that still need their attribute bytes set</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56644"></a>56644</td>
<td class="instruction">LD B,8</td>
<td class="comment-11" rowspan="1">The first 8 bytes in each line correspond to the Contact Sam Cruise logo</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56646"></a>56646</td>
<td class="instruction">LD (HL),23</td>
<td class="comment-11" rowspan="3">Set these attribute bytes to 23 (INK 7: PAPER 2)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56648"></a>56648</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56649"></a>56649</td>
<td class="instruction">DJNZ 56646</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56651"></a>56651</td>
<td class="instruction">LD B,12</td>
<td class="comment-11" rowspan="1">The next 12 bytes in each line correspond to the icon panel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56653"></a>56653</td>
<td class="instruction">LD (HL),54</td>
<td class="comment-11" rowspan="3">Set these attribute bytes to 54 (INK 6: PAPER 6)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56655"></a>56655</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56656"></a>56656</td>
<td class="instruction">DJNZ 56653</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56658"></a>56658</td>
<td class="instruction">LD B,9</td>
<td class="comment-11" rowspan="1">The next 9 bytes in each line correspond to the score box</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56660"></a>56660</td>
<td class="instruction">LD (HL),32</td>
<td class="comment-11" rowspan="3">Set these attribute bytes to 32 (INK 0: PAPER 4)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56662"></a>56662</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56663"></a>56663</td>
<td class="instruction">DJNZ 56660</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56665"></a>56665</td>
<td class="instruction">LD B,3</td>
<td class="comment-11" rowspan="1">The last 3 bytes in each line correspond to the disguise box</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="56667"></a>56667</td>
<td class="instruction">LD (HL),23</td>
<td class="comment-11" rowspan="3">Set these attribute bytes to 23 (INK 7: PAPER 2)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56669"></a>56669</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56670"></a>56670</td>
<td class="instruction">DJNZ 56667</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56672"></a>56672</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Have we done all 3 lines at the bottom of the screen?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56673"></a>56673</td>
<td class="instruction">JR NZ,56644</td>
<td class="comment-11" rowspan="1">Jump back to do the next line if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="56675"></a>56675</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="56064.html">56064</a></span></td>
<td class="up">Up: <a class="link" href="start.html#56576">Map</a></td>
<td class="next"><span class="next-0">Next: <a class="link" href=""></a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>