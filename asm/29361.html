<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 29361</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="29354.html">29354</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#29361">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="29558.html">29558</a></span></td>
</tr>
</table>
<div class="description">29361: Control a policeman (2)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this primary command routine is placed into bytes 8 and 9 of a policeman's buffer by the routine at <a class="link" href="29354.html">29354</a>. It makes the policeman continue patrol duty, and chase and pick up Sam when appropriate.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">222 or 223 (policeman)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29361"></a>29361</td>
<td class="instruction">CALL <a class="link" href="63128.html">63128</a></td>
<td class="comment-11" rowspan="1">Exit now if the policeman is midstride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29364"></a>29364</td>
<td class="instruction">CALL <a class="link" href="31998.html">31998</a></td>
<td class="comment-11" rowspan="2">Is Sam wanted by the police at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29367"></a>29367</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29368"></a>29368</td>
<td class="instruction">JR NC,29476</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29370"></a>29370</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Change the address of the primary command routine in bytes 8 and 9 of the policeman's buffer to <a class="link" href="29361.html#29374">29374</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29372"></a>29372</td>
<td class="instruction">LD (HL),190</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29374"></a>
<div class="comments">
<div class="paragraph">
This entry point is used when the policeman is not chasing Sam.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29374"></a>29374</td>
<td class="instruction">CALL <a class="link" href="63128.html">63128</a></td>
<td class="comment-11" rowspan="1">Exit now if the policeman is midstride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29377"></a>29377</td>
<td class="instruction">CALL <a class="link" href="31998.html">31998</a></td>
<td class="comment-11" rowspan="2">Is Sam wanted by the police at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29380"></a>29380</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29381"></a>29381</td>
<td class="instruction">JR C,29397</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29383"></a>29383</td>
<td class="instruction">LD L,29</td>
<td class="comment-11" rowspan="2">Clear any disguise identifier and timeout counter in byte 29 of the policeman's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29385"></a>29385</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29387"></a>29387</td>
<td class="instruction">LD L,3</td>
<td class="comment-11" rowspan="2">Reset bit 7 of byte 3 of the policeman's buffer (no need to run if Sam's not wanted by the police)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29389"></a>29389</td>
<td class="instruction">RES 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29391"></a>29391</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Change the address of the primary command routine in bytes 8 and 9 of the policeman's buffer to <a class="link" href="29361.html">29361</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29393"></a>29393</td>
<td class="instruction">LD (HL),177</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29395"></a>29395</td>
<td class="instruction">JR 29476</td>
<td class="comment-11" rowspan="1">Determine the policeman's next move</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29397"></a>
<div class="comments">
<div class="paragraph">
Sam is wanted by the police.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29397"></a>29397</td>
<td class="instruction">CALL <a class="link" href="29559.html">29559</a></td>
<td class="comment-11" rowspan="1">Make the policeman start chasing Sam if he spots him, or go to Sam's last known whereabouts if Sam's disguise has become known to the police</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29400"></a>29400</td>
<td class="instruction">JR NC,29419</td>
<td class="comment-11" rowspan="1">Jump if the policeman is now doing either of those things</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29402"></a>29402</td>
<td class="instruction">LD DE,32732</td>
<td class="comment-11" rowspan="1"><a class="link" href="32731.html#32732">32732</a> holds the y-coordinate of the location the police should be heading for to get Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29405"></a>29405</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick it up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29406"></a>29406</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Do the police know where they should be heading to get Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29407"></a>29407</td>
<td class="instruction">JR Z,29476</td>
<td class="comment-11" rowspan="1">Jump if not to make the policeman continue to go about his normal business</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29409"></a>29409</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=<a class="link" href="32731.html">32731</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29410"></a>29410</td>
<td class="instruction">LD BC,3</td>
<td class="comment-11" rowspan="5">Copy the coordinates and location identifier of the spot to which the police should be heading to get Sam into byte 10-12 of the policeman's buffer, thus making it his destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29413"></a>29413</td>
<td class="instruction">LD L,10</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29415"></a>29415</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29416"></a>29416</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29418"></a>29418</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29419"></a>29419</td>
<td class="instruction">LD L,3</td>
<td class="comment-11" rowspan="2">Set bit 7 of byte 3 of the policeman's buffer (to make him run)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29421"></a>29421</td>
<td class="instruction">SET 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29423"></a>29423</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Change the address of the primary command routine in bytes 8 and 9 of the policeman's buffer to <a class="link" href="29361.html#29429">29429</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29425"></a>29425</td>
<td class="instruction">LD (HL),245</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29427"></a>29427</td>
<td class="instruction">JR 29476</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29429"></a>
<div class="comments">
<div class="paragraph">
This entry point is used when the policeman is chasing Sam or heading to his last known whereabouts.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29429"></a>29429</td>
<td class="instruction">CALL <a class="link" href="31998.html">31998</a></td>
<td class="comment-11" rowspan="2">Should the police be chasing Sam at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29432"></a>29432</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29433"></a>29433</td>
<td class="instruction">JR NC,29374</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29435"></a>29435</td>
<td class="instruction">LD A,(32713)</td>
<td class="comment-11" rowspan="1">Collect the ID of Sam's current disguise from <a class="link" href="32713.html">32713</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29438"></a>29438</td>
<td class="instruction">ADD A,160</td>
<td class="comment-11" rowspan="2"><span class="register">B</span>=160-167</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29440"></a>29440</td>
<td class="instruction">LD B,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29441"></a>29441</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Transfer the policeman's character number to <span class="register">D</span> briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29442"></a>29442</td>
<td class="instruction">LD C,21</td>
<td class="comment-11" rowspan="1">Point <span class="register">BC</span> at byte 21 of one of the pages 160-167, which hold the values 128, 64, 32, 16, 8, 4, 2 and 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29444"></a>29444</td>
<td class="instruction">LD HL,32744</td>
<td class="comment-11" rowspan="1">The disguise status flags are stored at <a class="link" href="32744.html">32744</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29447"></a>29447</td>
<td class="instruction">LD A,(BC)</td>
<td class="comment-11" rowspan="2">Set the zero flag if Sam's disguise is unknown to the police</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29448"></a>29448</td>
<td class="instruction">AND (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29449"></a>29449</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Transfer the policeman's character number back to <span class="register">H</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29450"></a>29450</td>
<td class="instruction">JR Z,29467</td>
<td class="comment-11" rowspan="1">Jump if Sam's disguise is unknown to the police</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29452"></a>29452</td>
<td class="instruction">CALL <a class="link" href="28942.html">28942</a></td>
<td class="comment-11" rowspan="1">Is the policeman close enough to Sam to pick him up?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29455"></a>29455</td>
<td class="instruction">JR NC,29467</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29457"></a>29457</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="2">Clear the y-coordinate of the spot to which the police should run to get Sam at <a class="link" href="32731.html#32732">32732</a> (Sam has been caught)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29458"></a>29458</td>
<td class="instruction">LD (32732),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29461"></a>29461</td>
<td class="instruction">LD L,29</td>
<td class="comment-11" rowspan="2">Clear any disguise ID and timeout counter in byte 29 of the policeman's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29463"></a>29463</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29464"></a>29464</td>
<td class="instruction">JP <a class="link" href="31642.html">31642</a></td>
<td class="comment-11" rowspan="1">End the game if Sam has less than $46, or make the policeman pick Sam up</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29467"></a>
<div class="comments">
<div class="paragraph">
Sam's disguise is unknown to the police, or the policeman is not close enough to Sam to pick him up.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29467"></a>29467</td>
<td class="instruction">CALL <a class="link" href="63128.html">63128</a></td>
<td class="comment-11" rowspan="1">Exit now if the policeman is midstride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29470"></a>29470</td>
<td class="instruction">CALL <a class="link" href="29559.html">29559</a></td>
<td class="comment-11" rowspan="1">Make the policeman start chasing Sam if his disguise becomes known</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29473"></a>29473</td>
<td class="instruction">CALL <a class="link" href="29052.html">29052</a></td>
<td class="comment-11" rowspan="1">Make the policeman switch a light on if possible</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29476"></a>29476</td>
<td class="instruction">CALL <a class="link" href="60812.html">60812</a></td>
<td class="comment-11" rowspan="1">Determine the next move the policeman should make to reach his destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29479"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="62976.html">62976</a> with <span class="register">A</span>=1-6.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29479"></a>29479</td>
<td class="instruction">CP 5</td>
<td class="comment-11" rowspan="1">Is the character standing behind or in front of a closed door?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29481"></a>29481</td>
<td class="instruction">JP NC,<a class="link" href="62976.html#63100">63100</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29484"></a>29484</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is the character already at his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29485"></a>29485</td>
<td class="instruction">JP NZ,<a class="link" href="62976.html#63036">63036</a></td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29488"></a>
<div class="comments">
<div class="paragraph">
The policeman has reached his destination.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29488"></a>29488</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Collect the LSB of the primary command routine address from byte 8 of the policeman's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29490"></a>29490</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29491"></a>29491</td>
<td class="instruction">CP 245</td>
<td class="comment-11" rowspan="1">Is the primary command routine address <a class="link" href="29361.html#29429">29429</a> (which is true if the policeman was either chasing Sam or heading towards his last known whereabouts)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29493"></a>29493</td>
<td class="instruction">JR C,29536</td>
<td class="comment-11" rowspan="1">If not, send the policeman to a randomly chosen spot on the sidewalk or road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29495"></a>29495</td>
<td class="instruction">LD DE,32732</td>
<td class="comment-11" rowspan="2">Collect the y-coordinate of the location to which the police should run to get Sam from <a class="link" href="32731.html#32732">32732</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29498"></a>29498</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29499"></a>29499</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Do the police know where to run to get Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29500"></a>29500</td>
<td class="instruction">JR Z,29515</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29502"></a>29502</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 2 of the policeman's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29504"></a>29504</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Compare the policeman's y-coordinate with that of the spot to which the police should run to get Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29505"></a>29505</td>
<td class="instruction">DEC DE</td>
<td class="comment-11" rowspan="1"><span class="register">DE</span>=32731</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29506"></a>29506</td>
<td class="instruction">JR NZ,29525</td>
<td class="comment-11" rowspan="1">Jump unless the policeman's y-coordinate matches</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29508"></a>29508</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29509"></a>29509</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the spot to which the police should run to get Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29510"></a>29510</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Does it match the policeman's x-coordinate?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29511"></a>29511</td>
<td class="instruction">JR NZ,29525</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29513"></a>29513</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="2">Set <a class="link" href="32731.html#32732">32732</a> to 0 now that a policeman has made it to the spot to which the police should run to get Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29514"></a>29514</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29515"></a>29515</td>
<td class="instruction">LD L,3</td>
<td class="comment-11" rowspan="2">Reset bit 7 of byte 3 of the policeman's buffer (to make him stop running)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29517"></a>29517</td>
<td class="instruction">RES 7,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29519"></a>29519</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Change the address of the primary command routine in bytes 8 and 9 of the policeman's buffer to <a class="link" href="29361.html#29374">29374</a> (above)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29521"></a>29521</td>
<td class="instruction">LD (HL),190</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29523"></a>29523</td>
<td class="instruction">JR 29536</td>
<td class="comment-11" rowspan="1">Send the policeman to a randomly chosen spot on the sidewalk or road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29525"></a>29525</td>
<td class="instruction">LD L,10</td>
<td class="comment-11" rowspan="4">Copy the coordinates and location identifier of the spot to which the police should run to get Sam from <a class="link" href="32731.html">32731</a> into bytes 10-12 of the policeman's buffer, thus making it his destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29527"></a>29527</td>
<td class="instruction">LD BC,3</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29530"></a>29530</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29531"></a>29531</td>
<td class="instruction">LDIR</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29533"></a>29533</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> back at the policeman's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29534"></a>29534</td>
<td class="instruction">JR 29476</td>
<td class="comment-11" rowspan="1">Determine the policeman's next move</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="29536"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="29354.html">29354</a>. It sets the policeman's destination to a randomly chosen spot on the sidewalk or road.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="29536"></a>29536</td>
<td class="instruction">CALL <a class="link" href="61823.html">61823</a></td>
<td class="comment-11" rowspan="1">Get a random number in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29539"></a>29539</td>
<td class="instruction">OR 0</td>
<td class="comment-11" rowspan="1">The operand of this OR instruction is changed by the routine at <a class="link" href="29952.html">29952</a>: to 0 (using the event entry at <a class="link" href="24544.html">24544</a>), or to 192 (using the event entry at <a class="link" href="24544.html#24727">24727</a>) to keep the policeman close to Sam's office</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29541"></a>29541</td>
<td class="instruction">AND 253</td>
<td class="comment-11" rowspan="1">Discard bit 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29543"></a>29543</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1">Copy this x-coordinate to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29544"></a>29544</td>
<td class="instruction">CALL <a class="link" href="60152.html#60165">60165</a></td>
<td class="comment-11" rowspan="1">Set the carry flag if there is no sidewalk at this x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29547"></a>29547</td>
<td class="instruction">ADC A,34</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=34 (if there is sidewalk) or 35 (if there is no sidewalk)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29549"></a>29549</td>
<td class="instruction">SUB E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29550"></a>29550</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1">Copy this y-coordinate to <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29551"></a>29551</td>
<td class="instruction">LD C,0</td>
<td class="comment-11" rowspan="1">Clear bit 0 of <span class="register">C</span> to indicate that the destination is not indoors</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29553"></a>29553</td>
<td class="instruction">CALL <a class="link" href="29072.html#29076">29076</a></td>
<td class="comment-11" rowspan="1">Set the policeman's destination to the coordinates in <span class="register">E</span>, <span class="register">D</span> and <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="29556"></a>29556</td>
<td class="instruction">JR 29476</td>
<td class="comment-11" rowspan="1">Determine the policeman's next move</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="29354.html">29354</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#29361">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="29558.html">29558</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20140614</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>