<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 25118</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25113.html">25113</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25118">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25306.html">25306</a></span></td>
</tr>
</table>
<div class="description">25118: Control the sniper while active</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this interruptible subcommand routine is placed into bytes 14 and 15 of the sniper's buffer by the routine at <a class="link" href="25307.html">25307</a>. It controls the sniper from the moment he appears until he hides again.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">227 (sniper)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25118"></a>25118</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=sniper's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25120"></a>25120</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25121"></a>25121</td>
<td class="instruction">LD L,17</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 17 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25123"></a>25123</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="2">Is it zero (meaning the sniper has not fired recently)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25124"></a>25124</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25125"></a>25125</td>
<td class="instruction">JR Z,25128</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25127"></a>25127</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Otherwise decrement byte 17</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25128"></a>25128</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=16</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25129"></a>25129</td>
<td class="instruction">CP 50</td>
<td class="comment-11" rowspan="1">The sniper's y-coordinate is 50 when he's inactive</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25131"></a>25131</td>
<td class="instruction">JR NZ,25168</td>
<td class="comment-11" rowspan="1">Jump if the sniper is currently active</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25133"></a>
<div class="comments">
<div class="paragraph">
The sniper is currently inactive.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25133"></a>25133</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrement byte 16 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25134"></a>25134</td>
<td class="instruction">JP Z,<a class="link" href="62080.html#62084">62084</a></td>
<td class="comment-11" rowspan="1">Terminate this subcommand if byte 16 is now 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25137"></a>25137</td>
<td class="instruction">CALL <a class="link" href="26328.html">26328</a></td>
<td class="comment-11" rowspan="1">Is the sniper on screen at least 8 x-coordinates away from Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25140"></a>25140</td>
<td class="instruction">NOP</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25141"></a>25141</td>
<td class="instruction">JP NZ,<a class="link" href="62080.html#62084">62084</a></td>
<td class="comment-11" rowspan="1">Terminate this subcommand if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25144"></a>25144</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 2 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25145"></a>25145</td>
<td class="instruction">LD (HL),37</td>
<td class="comment-11" rowspan="1">Set the sniper's y-coordinate to 37 (out of sight, but ready to emerge)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25147"></a>25147</td>
<td class="instruction">LD A,(58881)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25150"></a>25150</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25151"></a>25151</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-11" rowspan="1">Subtract the sniper's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25152"></a>25152</td>
<td class="instruction">CCF</td>
<td class="comment-11" rowspan="3">Compute the appropriate animatory state for the sniper: <a class="link" href="../graphics/as.html#54">54</a> if he's to the right of Sam, <a class="link" href="../graphics/as.html#182">182</a> if he's to the left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25153"></a>25153</td>
<td class="instruction">LD A,108</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25155"></a>25155</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25156"></a>25156</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="2">Set the sniper's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25157"></a>25157</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25158"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="28646.html">28646</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25158"></a>25158</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="4">Collect the sniper's x- and y-coordinates in <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25160"></a>25160</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25161"></a>25161</td>
<td class="instruction">DEC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25162"></a>25162</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25163"></a>25163</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=sniper's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25164"></a>25164</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25165"></a>25165</td>
<td class="instruction">JP <a class="link" href="26224.html">26224</a></td>
<td class="comment-11" rowspan="1">Update the sniper's sprite tile references</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25168"></a>
<div class="comments">
<div class="paragraph">
The sniper is currently active (his y-coordinate is 34-37).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25168"></a>25168</td>
<td class="instruction">LD A,(57014)</td>
<td class="comment-11" rowspan="1">Collect the sprite tile reference for tile 7 of animatory states <a class="link" href="../graphics/as.html#54">54/182</a>; this will be 235 if the sniper is firing, or 0, 110, 111 or 113 otherwise</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25171"></a>25171</td>
<td class="instruction">CP H</td>
<td class="comment-11" rowspan="1">Is the sniper firing?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25172"></a>25172</td>
<td class="instruction">JP NC,<a class="link" href="28646.html">28646</a></td>
<td class="comment-11" rowspan="1">If so, make the firing sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25175"></a>25175</td>
<td class="instruction">LD A,(32767)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=y-coordinate of the topmost row of the play area on screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25178"></a>25178</td>
<td class="instruction">CP 20</td>
<td class="comment-11" rowspan="1">Is the sidewalk on screen?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25180"></a>25180</td>
<td class="instruction">JR NZ,25193</td>
<td class="comment-11" rowspan="1">If not, deactivate the sniper and terminate this subcommand</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25182"></a>25182</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-11" rowspan="1">Decrement byte 16 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25183"></a>25183</td>
<td class="instruction">JR NZ,25210</td>
<td class="comment-11" rowspan="1">Jump unless byte 16 is now zero</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25185"></a>
<div class="comments">
<div class="paragraph">
Byte 16 of the sniper's buffer has been decremented to zero. The apparent intention here is to make the sniper duck out of sight and terminate this subcommand; however, if the sniper is not already out of sight, he will duck briefly but remain in view, and byte 16 will be decremented to 255 on the next pass through this routine. This is a <a class="link" href="../reference/bugs.html#conspicuousSniper">bug</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25185"></a>25185</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the sniper's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25188"></a>25188</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=sniper's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25189"></a>25189</td>
<td class="instruction">CP 37</td>
<td class="comment-11" rowspan="1">Is the sniper currently out of sight?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25191"></a>25191</td>
<td class="instruction">JR NZ,25202</td>
<td class="comment-11" rowspan="1">Jump if not to make him duck</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25193"></a>25193</td>
<td class="instruction">LD L,15</td>
<td class="comment-11" rowspan="2">Remove the address of this routine from byte 14 and 15 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25195"></a>25195</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25197"></a>25197</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="2">Set the sniper's y-coordinate to 50 (inactive)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25199"></a>25199</td>
<td class="instruction">LD (HL),50</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25201"></a>25201</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25202"></a>
<div class="comments">
<div class="paragraph">
The sniper is in the process of ducking.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25202"></a>25202</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=sniper's next y-coordinate (35-37)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25203"></a>25203</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25205"></a>25205</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=sniper's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25206"></a>25206</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Reset the carry flag to indicate that the sniper is not firing</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25207"></a>25207</td>
<td class="instruction">JP <a class="link" href="26224.html">26224</a></td>
<td class="comment-11" rowspan="1">Update the sniper's sprite tile references</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25210"></a>
<div class="comments">
<div class="paragraph">
Byte 16 of the sniper's buffer is not zero.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25210"></a>25210</td>
<td class="instruction">CALL <a class="link" href="26328.html">26328</a></td>
<td class="comment-11" rowspan="1">Compare the sniper's coordinates with Sam's</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25213"></a>25213</td>
<td class="instruction">JR Z,25227</td>
<td class="comment-11" rowspan="1">Jump if the sniper is on screen and at least 8 x-coordinates away from Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25215"></a>25215</td>
<td class="instruction">JR NC,25193</td>
<td class="comment-11" rowspan="1">Terminate this subcommand if the sniper if off screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25217"></a>25217</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the sniper's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25220"></a>25220</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=sniper's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25221"></a>25221</td>
<td class="instruction">CP 37</td>
<td class="comment-11" rowspan="1">Has the sniper already ducked out of sight?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25223"></a>25223</td>
<td class="instruction">JR NZ,25202</td>
<td class="comment-11" rowspan="1">Jump if not to make the sniper continue ducking</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25225"></a>25225</td>
<td class="instruction">JR 25197</td>
<td class="comment-11" rowspan="1">Deactivate the sniper</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25227"></a>
<div class="comments">
<div class="paragraph">
The sniper is on screen and at least 8 x-coordinates away from Sam. If he's already popped his head out far enough (his y-coordinate is 34 or 35), he can consider shooting; otherwise he'll need to emerge a little further first.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25227"></a>25227</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 2 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25229"></a>25229</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=sniper's y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25230"></a>25230</td>
<td class="instruction">CP 36</td>
<td class="comment-11" rowspan="1">Is at least half of the sniper visible?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25232"></a>25232</td>
<td class="instruction">JR C,25240</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25234"></a>25234</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the sniper's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25237"></a>25237</td>
<td class="instruction">DEC D</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=sniper's next y-coordinate (35 or 36)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25238"></a>25238</td>
<td class="instruction">JR 25206</td>
<td class="comment-11" rowspan="1">Jump back to update the sniper's sprite tile references</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25240"></a>
<div class="comments">
<div class="paragraph">
At least half of the sniper is visible (his y-coordinate is 34 or 35), which means he can shoot.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25240"></a>25240</td>
<td class="instruction">LD L,16</td>
<td class="comment-11" rowspan="2">Collect byte 16 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25242"></a>25242</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25243"></a>25243</td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="1">Is bit 0 or bit 1 set?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25245"></a>25245</td>
<td class="instruction">JR NZ,25263</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25247"></a>25247</td>
<td class="instruction">CALL <a class="link" href="61823.html">61823</a></td>
<td class="comment-11" rowspan="1">Get a random number in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25250"></a>25250</td>
<td class="instruction">CP 160</td>
<td class="comment-11" rowspan="1">Should the sniper consider shooting?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25252"></a>25252</td>
<td class="instruction">JR C,25263</td>
<td class="comment-11" rowspan="1">Jump if so (5 times out of 8)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25254"></a>25254</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the sniper's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25257"></a>25257</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=sniper's y-coordinate (34 or 35)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25258"></a>25258</td>
<td class="instruction">XOR 1</td>
<td class="comment-11" rowspan="1">Toggle between 34 and 35</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25260"></a>25260</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=sniper's next y-coordinate (35 or 34)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25261"></a>25261</td>
<td class="instruction">JR 25203</td>
<td class="comment-11" rowspan="1">Jump back to update the sniper's sprite tile references</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25263"></a>
<div class="comments">
<div class="paragraph">
The sniper will consider shooting.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25263"></a>25263</td>
<td class="instruction">LD A,(58884)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's z-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25266"></a>25266</td>
<td class="instruction">RRCA</td>
<td class="comment-11" rowspan="1">Is Sam indoors?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25267"></a>25267</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25268"></a>25268</td>
<td class="instruction">LD A,(32764)</td>
<td class="comment-11" rowspan="1">Collect Sam's status flags from <a class="link" href="32764.html">32764</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25271"></a>25271</td>
<td class="instruction">AND 129</td>
<td class="comment-11" rowspan="1">Is Sam falling from a building or being carried?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25273"></a>25273</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25274"></a>25274</td>
<td class="instruction">LD L,17</td>
<td class="comment-11" rowspan="2">Collect byte 17 of the sniper's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25276"></a>25276</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25277"></a>25277</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has the sniper fired recently?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25278"></a>25278</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25279"></a>25279</td>
<td class="instruction">CALL <a class="link" href="61823.html">61823</a></td>
<td class="comment-11" rowspan="1">Get a random number in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25282"></a>25282</td>
<td class="instruction">CP 84</td>
<td class="comment-11" rowspan="1">Should the sniper continue to consider shooting?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25284"></a>25284</td>
<td class="instruction">RET NC</td>
<td class="comment-11" rowspan="1">Return if not (21 times out of 64)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25285"></a>25285</td>
<td class="instruction">LD DE,32706</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the third byte of bullet buffer 1 (at <a class="link" href="32704.html">32704</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25288"></a>25288</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25289"></a>25289</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is bullet buffer 1 in use?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25290"></a>25290</td>
<td class="instruction">JR Z,25297</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25292"></a>25292</td>
<td class="instruction">LD E,198</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the third byte of bullet buffer 2 (at <a class="link" href="32708.html">32708</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25294"></a>25294</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25295"></a>25295</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is bullet buffer 2 in use?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25296"></a>25296</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25297"></a>
<div class="comments">
<div class="paragraph">
The sniper has decided to shoot, and a bullet buffer is available.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25297"></a>25297</td>
<td class="instruction">LD (HL),12</td>
<td class="comment-11" rowspan="1">Place 12 into byte 17 of the sniper's buffer (indicating that he's just fired)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25299"></a>25299</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the sniper's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25302"></a>25302</td>
<td class="instruction">SCF</td>
<td class="comment-11" rowspan="1">Set the carry flag to indicate that the sniper is firing</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25303"></a>25303</td>
<td class="instruction">JP <a class="link" href="26224.html">26224</a></td>
<td class="comment-11" rowspan="1">Update the sniper's sprite tile references and initialise a bullet</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25113.html">25113</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25118">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25306.html">25306</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>