<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 28803</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="28760.html">28760</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#28803">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="28841.html">28841</a></span></td>
</tr>
</table>
<div class="description">28803: Check whether a character is on a roof with edges on each side</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="60812.html">60812</a>. Returns to the caller of that routine with <span class="register">A</span> holding 1 (go right), 2 (go left) or 3 (go up) if the character is on the roof of the police station or the apartment building next to no. 19 and is heading for the edge of that roof. Otherwise returns with the zero flag set if the character is standing outside the entrance to a shop or other building.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Identifier for the character's current location (see <a class="link" href="60726.html">60726</a>)</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-230)</td>
</tr>
<tr>
<td class="register">L</td>
<td class="register-desc">12</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28803"></a>28803</td>
<td class="instruction">CP 252</td>
<td class="comment-11" rowspan="1">Is the character on the roof of the apartment building next to no. 19?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28805"></a>28805</td>
<td class="instruction">JR Z,28811</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28807"></a>28807</td>
<td class="instruction">CP 108</td>
<td class="comment-11" rowspan="1">Is the character on the roof of the police station?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28809"></a>28809</td>
<td class="instruction">JR NZ,28816</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28811"></a>28811</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=109 (police station) or 253 (apartment building next to no. 19)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28812"></a>28812</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character's destination on the edge of the roof of either the police station or the apartment building next to no. 19?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28813"></a>28813</td>
<td class="instruction">JR Z,28821</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28815"></a>28815</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=108 or 252</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28816"></a>28816</td>
<td class="instruction">AND 15</td>
<td class="comment-11" rowspan="1">Keep only bits 0-3 of the location identifier</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28818"></a>28818</td>
<td class="instruction">CP 2</td>
<td class="comment-11" rowspan="1">Set the zero flag if the character is standing outside the entrance to a shop or other building</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28820"></a>28820</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="28821"></a>
<div class="comments">
<div class="paragraph">
The character is on the roof of the apartment building next to no. 19 or on the roof of the police station, and his destination is on the edge of that roof.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28821"></a>28821</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Drop the return address from the stack</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28822"></a>28822</td>
<td class="instruction">LD L,10</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 10 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28824"></a>28824</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's destination x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28825"></a>28825</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="2">Compare this with the character's current x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28827"></a>28827</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28828"></a>28828</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28829"></a>28829</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Set the zero flag if the character is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28831"></a>28831</td>
<td class="instruction">LD A,3</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=3 (go up)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28833"></a>28833</td>
<td class="instruction">JR C,28838</td>
<td class="comment-11" rowspan="1">Jump if the character is to the right of his destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28835"></a>28835</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return to the caller of <a class="link" href="60812.html">60812</a> with <span class="register">A</span>=3 (go up) if the character is to the left of his destination and facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28836"></a>28836</td>
<td class="instruction">LD A,1</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1 (go right)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="28838"></a>28838</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return to the caller of <a class="link" href="60812.html">60812</a> with <span class="register">A</span>=1 (go right) if the character is to the left of his destination and facing left, or with <span class="register">A</span>=3 (go up) if the character is to the right of his destination and facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28839"></a>28839</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="2">Return to the caller of <a class="link" href="60812.html">60812</a> with <span class="register">A</span>=2 (go left) if the character is to the right of his destination and facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="28840"></a>28840</td>
<td class="instruction">RET</td>
<td class="comment-01" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="28760.html">28760</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#28803">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="28841.html">28841</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>