<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 63749</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63662.html">63662</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63749">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63774.html">63774</a></span></td>
</tr>
</table>
<div class="description">63749: Check whether a character is in the correct spot to enter a building</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="60812.html">60812</a>. The character in question is standing outside the entrance to a shop or other building, and his destination is somewhere inside. This routine returns with the zero flag set if the character is standing in the correct spot (and facing the right way) to enter the building or knock on the door; otherwise it returns with the zero flag reset, and the carry flag reset if the character should move left, or set if he should move right in order to reach the correct spot.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">D</td>
<td class="register-desc">x-coordinate of the right edge of the doorway</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-230)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63749"></a>63749</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63751"></a>63751</td>
<td class="instruction">LD A,D</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x-coordinate of the right edge of the doorway</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63752"></a>63752</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Compare this with the character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63753"></a>63753</td>
<td class="instruction">JR NZ,63763</td>
<td class="comment-11" rowspan="1">Jump unless they match</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63755"></a>63755</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is the character's x-coordinate 0 (meaning he is standing at the doorway of the shop at the far left of town)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63756"></a>63756</td>
<td class="instruction">JR Z,63767</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63758"></a>63758</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63759"></a>63759</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Set the zero flag if the character is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63761"></a>63761</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63762"></a>63762</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Return with the zero flag set if the character is facing left (he can enter or knock now); otherwise return with the zero flag reset and the carry flag reset (he should turn round first)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63763"></a>
<div class="comments">
<div class="paragraph">
The character is not standing at the right edge of the doorway. Is he standing at the left edge?
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63763"></a>63763</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<span class="register">D</span>-1 (x-coordinate of the left edge of the doorway)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63764"></a>63764</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Compare this with the character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63765"></a>63765</td>
<td class="instruction">CCF</td>
<td class="comment-11" rowspan="1">Set the carry flag if the character's x-coordinate is less than <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63766"></a>63766</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return with the zero flag reset (and the carry flag reset if the character's x-coordinate is at least <span class="register">D</span>, set if it's less than <span class="register">D</span>-1) if the character is not standing at the left edge of the doorway</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63767"></a>
<div class="comments">
<div class="paragraph">
The character is either standing at the doorway of the shop at the far left of town (at x-coordinate 0), or standing at the left edge of some other doorway.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63767"></a>63767</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63768"></a>63768</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63769"></a>63769</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63770"></a>63770</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="3">Set the zero flag if the character is facing right; otherwise reset the zero flag and set the carry flag (the character should turn round first)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63771"></a>63771</td>
<td class="instruction">CCF</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63772"></a>63772</td>
<td class="instruction">SBC A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63773"></a>63773</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63662.html">63662</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63749">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63774.html">63774</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20140614</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>