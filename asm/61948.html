<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 61948</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="61923.html">61923</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#61948">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="62080.html">62080</a></span></td>
</tr>
</table>
<div class="description">61948: Move the characters</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Called from the main loop at <a class="link" href="61483.html">61483</a>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="61948"></a>61948</td>
<td class="instruction">LD HL,32674</td>
<td class="comment-11" rowspan="1">The blown fuse delay counters are stored at <a class="link" href="32674.html">32674</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61951"></a>61951</td>
<td class="instruction">LD B,5</td>
<td class="comment-11" rowspan="5">Set <span class="register">A</span> to a non-zero value if any of the fuses are currently blown</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61953"></a>61953</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="61954"></a>61954</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61955"></a>61955</td>
<td class="instruction">OR (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61956"></a>61956</td>
<td class="instruction">DJNZ 61954</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61958"></a>61958</td>
<td class="instruction">LD (32692),A</td>
<td class="comment-11" rowspan="1">Store this value at <a class="link" href="32692.html">32692</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61961"></a>61961</td>
<td class="instruction">CALL 61967</td>
<td class="comment-11" rowspan="1">Move one character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61964"></a>61964</td>
<td class="instruction">CALL 61967</td>
<td class="comment-11" rowspan="1">Move the next character</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="61967"></a>61967</td>
<td class="instruction">LD HL,32763</td>
<td class="comment-11" rowspan="1"><a class="link" href="32763.html">32763</a> holds the number of the character just moved</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61970"></a>61970</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Increment this</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61971"></a>61971</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=number of the character to move next</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61972"></a>61972</td>
<td class="instruction">CP 230</td>
<td class="comment-11" rowspan="1">Is it Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61974"></a>61974</td>
<td class="instruction">JR NZ,61979</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61976"></a>61976</td>
<td class="instruction">LD A,215</td>
<td class="comment-11" rowspan="1">Rewind to character 215 (we don't want to move Sam)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61978"></a>61978</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-11" rowspan="1">Store the number of the character to be moved next</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="61979"></a>61979</td>
<td class="instruction">LD H,A</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=number of the character to move next (215-229)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="61980"></a>
<div class="comments">
<div class="paragraph">
First check whether the character is immobilised by a blown fuse.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61980"></a>61980</td>
<td class="instruction">LD A,(32692)</td>
<td class="comment-11" rowspan="1">Collect the blown fuse indicator from <a class="link" href="32692.html">32692</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61983"></a>61983</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Are any fuses currently blown?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61984"></a>61984</td>
<td class="instruction">CALL NZ,<a class="link" href="29004.html">29004</a></td>
<td class="comment-11" rowspan="1">If so, check to see whether the character is immobilised by a blown fuse</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61987"></a>61987</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if the character is immobilised</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="61988"></a>
<div class="comments">
<div class="paragraph">
Now to determine whether to move the character this time round. The answer will be yes if bit 7 of byte 3 of the character's buffer is set (indicating that he is running), or if bit 6 of byte 3 (which is flipped on each pass through this routine) is set.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61988"></a>61988</td>
<td class="instruction">LD L,3</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 3 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61990"></a>61990</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the character running?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61992"></a>61992</td>
<td class="instruction">JR NZ,62001</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61994"></a>61994</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="3">Flip bit 6 of byte 3 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61995"></a>61995</td>
<td class="instruction">XOR 64</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61997"></a>61997</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="61998"></a>61998</td>
<td class="instruction">AND 64</td>
<td class="comment-11" rowspan="1">Is bit 6 set now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62000"></a>62000</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62001"></a>
<div class="comments">
<div class="paragraph">
The character will be moved. From this point, the following steps are taken:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Step</th>
<th>Action</th>
</tr>
<tr>
<td class="centre">1</td>
<td>If there is an uninterruptible subcommand routine address in bytes 18 and 19 of the character's buffer, jump to it</td>
</tr>
<tr>
<td class="centre">2</td>
<td>If there is a continual subcommand routine address in bytes 27 and 28 of the character's buffer - which there never is - call it (and then return to step 3)</td>
</tr>
<tr>
<td class="centre">3</td>
<td>If there is an interruptible subcommand routine address in bytes 14 and 15 of the character's buffer, jump to it</td>
</tr>
<tr>
<td class="centre">4</td>
<td>Restart the command list if bit 4 of byte 3 of the character's buffer is set (and carry on to step 5)</td>
</tr>
<tr>
<td class="centre">5</td>
<td>If there is a primary command routine address in bytes 8 and 9 of the character's buffer, jump to it</td>
</tr>
<tr>
<td class="centre">6</td>
<td>Remove any continual subcommand routine address from bytes 27 and 28 of the character's buffer</td>
</tr>
<tr>
<td class="centre">7</td>
<td>Collect the next primary command routine address from the command list, place it into bytes 8 and 9 of the character's buffer, and jump to it</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following uninterruptible subcommand routines (or an entry point thereof) may be present in bytes 18 and 19 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Address</th>
<th>Description</th>
</tr>
<tr>
<td class="centre"><a class="link" href="31670.html">31670</a></td>
<td>Control the hook while it's flying</td>
</tr>
<tr>
<td class="centre"><a class="link" href="64005.html">64005</a></td>
<td>Deal with a character who has been knocked over</td>
</tr>
<tr>
<td class="centre"><a class="link" href="64131.html">64131</a></td>
<td>Deal with a character who has nearly recovered from being knocked over</td>
</tr>
<tr>
<td class="centre"><a class="link" href="64331.html">64331</a></td>
<td>Control a character who has stepped off the roof of a building</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following interruptible subcommand routines (or an entry point thereof) may be present in bytes 14 and 15 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Address</th>
<th>Description</th>
</tr>
<tr>
<td class="centre"><a class="link" href="25118.html">25118</a></td>
<td>Control the sniper while active</td>
</tr>
<tr>
<td class="centre"><a class="link" href="31319.html">31319</a></td>
<td>Make a gangster walk up or down until Sam arrives</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62278.html">62278</a></td>
<td>Control a character who is knocking on or opening a door (1)</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62297.html">62297</a></td>
<td>Control a character who has knocked on a door and is waiting for an answer</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62339.html">62339</a></td>
<td>Control a character who is knocking on or opening a door (3)</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62892.html">62892</a></td>
<td>Guide a character up or down staircases</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62926.html">62926</a></td>
<td>Guide a character across a floor to his destination</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62971.html">62971</a></td>
<td>Guide a character from one spot on the sidewalk or road to another</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63209.html">63209</a></td>
<td>Make a character walk up or down</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63558.html">63558</a></td>
<td>Make a cat run up or down</td>
</tr>
</table>
</div>
<div class="paragraph">
The address of one of the following primary command routines (or an entry point thereof) may be present in bytes 8 and 9 of the character's buffer:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th>Address</th>
<th>Description</th>
</tr>
<tr>
<td class="centre"><a class="link" href="24925.html">24925</a></td>
<td>Reset a gangster's location and restart the command list</td>
</tr>
<tr>
<td class="centre"><a class="link" href="25081.html">25081</a></td>
<td>Make the gangster at no. 15 lie in wait for Sam</td>
</tr>
<tr>
<td class="centre"><a class="link" href="25307.html">25307</a></td>
<td>Control the sniper</td>
</tr>
<tr>
<td class="centre"><a class="link" href="25385.html">25385</a></td>
<td>Make a gangster chase Sam</td>
</tr>
<tr>
<td class="centre"><a class="link" href="25420.html">25420</a></td>
<td>Control a banknote</td>
</tr>
<tr>
<td class="centre"><a class="link" href="29354.html">29354</a></td>
<td>Control a policeman (1)</td>
</tr>
<tr>
<td class="centre"><a class="link" href="29361.html">29361</a></td>
<td>Control a policeman (2)</td>
</tr>
<tr>
<td class="centre"><a class="link" href="31338.html">31338</a></td>
<td>Make a gangster walk up and down while watching for Sam</td>
</tr>
<tr>
<td class="centre"><a class="link" href="31594.html">31594</a></td>
<td>Let Sam out of jail if necessary</td>
</tr>
<tr>
<td class="centre"><a class="link" href="59136.html#59147">59147</a></td>
<td>Do nothing</td>
</tr>
<tr>
<td class="centre"><a class="link" href="62976.html">62976</a></td>
<td>Make a character go to a location</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63198.html">63198</a></td>
<td>Restart the command list</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63281.html">63281</a></td>
<td>Make a character drop Sam</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63304.html">63304</a></td>
<td>Make a character walk up and down until somebody knocks on a door</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63423.html">63423</a></td>
<td>Make a character open a door that has been knocked on</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63520.html">63520</a></td>
<td>Make a character walk up and down for a while</td>
</tr>
<tr>
<td class="centre"><a class="link" href="63530.html">63530</a></td>
<td>Control a cat</td>
</tr>
</table>
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62001"></a>62001</td>
<td class="instruction">LD L,19</td>
<td class="comment-11" rowspan="3">Is there an uninterruptible subcommand routine address in bytes 18 and 19 of the character's buffer?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62003"></a>62003</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62004"></a>62004</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62005"></a>62005</td>
<td class="instruction">JR NZ,62075</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62007"></a>62007</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=number of the character being moved (215-229)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62008"></a>62008</td>
<td class="instruction">CP 222</td>
<td class="comment-11" rowspan="1">Does the character belong to one of the character groups 215-221?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62010"></a>62010</td>
<td class="instruction">JR C,62029</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62012"></a>
<div class="comments">
<div class="paragraph">
We're dealing with one of the primary characters (222-229). Here we check whether there is a continual subcommand routine address in bytes 27 and 28 of the character's buffer. The answer is always no.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62012"></a>62012</td>
<td class="instruction">LD L,28</td>
<td class="comment-11" rowspan="3">Byte 28 is unused and always holds 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62014"></a>62014</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62015"></a>62015</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62016"></a>62016</td>
<td class="instruction">JR Z,62029</td>
<td class="comment-11" rowspan="1">This jump is always made</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62018"></a>62018</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62019"></a>62019</td>
<td class="instruction">LD BC,62028</td>
<td class="comment-11" rowspan="2">We will return to <a class="link" href="61948.html#62028">62028</a> (below) after calling the subcommand routine</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62022"></a>62022</td>
<td class="instruction">PUSH BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62023"></a>62023</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="3">Collect the continual subcommand routine address into <span class="register">BC</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62024"></a>62024</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62025"></a>62025</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62026"></a>62026</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Push it onto the stack</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62027"></a>62027</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1">Call the continual subcommand routine and then return to <a class="link" href="61948.html#62028">62028</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62028"></a>62028</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the character number to <span class="register">H</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62029"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="62080.html">62080</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62029"></a>62029</td>
<td class="instruction">LD L,15</td>
<td class="comment-11" rowspan="3">Is there an interruptible subcommand routine address in bytes 14 and 15 of the character's buffer?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62031"></a>62031</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62032"></a>62032</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62033"></a>62033</td>
<td class="instruction">JR NZ,62075</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62035"></a>
<div class="comments">
<div class="paragraph">
Bit 4 of byte 3 of the character's buffer is never set, but if it were, it would mean that the character's command list should be restarted. Check bit 4 of byte 3 now.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62035"></a>62035</td>
<td class="instruction">LD L,3</td>
<td class="comment-11" rowspan="2">Bit 4 of byte 3 is unused and always reset</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62037"></a>62037</td>
<td class="instruction">BIT 4,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62039"></a>62039</td>
<td class="instruction">JR Z,62055</td>
<td class="comment-11" rowspan="1">This jump is always made</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62041"></a>62041</td>
<td class="instruction">RES 4,(HL)</td>
<td class="comment-11" rowspan="1">Reset bit 4 of byte 3</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62043"></a>62043</td>
<td class="instruction">LD L,26</td>
<td class="comment-11" rowspan="5">Copy the command list address from bytes 25 and 26 of the character's buffer into bytes 23 and 24</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62045"></a>62045</td>
<td class="instruction">LD D,H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62046"></a>62046</td>
<td class="instruction">LD E,24</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62048"></a>62048</td>
<td class="instruction">LDD</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62050"></a>62050</td>
<td class="instruction">LDD</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62052"></a>62052</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Set byte 22 of the character's buffer (which holds the offset reached in the command list) to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62053"></a>62053</td>
<td class="instruction">JR 62061</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62055"></a>
<div class="comments">
<div class="paragraph">
Now we look for a primary command routine address.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62055"></a>62055</td>
<td class="instruction">LD L,9</td>
<td class="comment-11" rowspan="3">Is there a primary command routine address in bytes 8 and 9 of the character's buffer?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62057"></a>62057</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62058"></a>62058</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62059"></a>62059</td>
<td class="instruction">JR NZ,62075</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62061"></a>62061</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=number of the character being moved (215-229)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62062"></a>62062</td>
<td class="instruction">CP 222</td>
<td class="comment-11" rowspan="1">Does the character belong to one of the character groups 215-221?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62064"></a>62064</td>
<td class="instruction">JR C,62070</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62066"></a>62066</td>
<td class="instruction">LD L,28</td>
<td class="comment-11" rowspan="2">Remove any continual subcommand routine address from bytes 27 and 28 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62068"></a>62068</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62070"></a>62070</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Copy the next primary command routine address from the command list into bytes 8 and 9 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62072"></a>62072</td>
<td class="instruction">CALL <a class="link" href="61809.html">61809</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62075"></a>62075</td>
<td class="instruction">LD B,(HL)</td>
<td class="comment-11" rowspan="3">Copy the address of the primary command or subcommand routine into <span class="register">BC</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62076"></a>62076</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62077"></a>62077</td>
<td class="instruction">LD C,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62078"></a>62078</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="2">Make an indirect jump to the routine</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62079"></a>62079</td>
<td class="instruction">RET</td>
<td class="comment-01" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="61923.html">61923</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#61948">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="62080.html">62080</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20140614</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>