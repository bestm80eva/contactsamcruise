<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 64512</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="64338.html">64338</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#64512">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="64549.html">64549</a></span></td>
</tr>
</table>
<div class="description">64512: Deal with a character who is stepping onto or over the roof of no. 19</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="64338.html">64338</a>. If the character is about to step off the edge of the roof of no. 17 or the apartment building next to no. 19 towards no. 19, this routine checks whether there is a rope above the roof of no. 19 and moves the character accordingly. Otherwise, if the character is about to move left onto the roof of no. 17 (having just crossed the roof of no. 19 by means of the rope), this routine removes the rope.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Location indicator (2-6; see <a class="link" href="64338.html">64338</a>)</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-230)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64512"></a>64512</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=location indicator</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64513"></a>64513</td>
<td class="instruction">CP 2</td>
<td class="comment-11" rowspan="1">Is the character standing on the right edge of the roof of one of the apartment buildings (next to no. 74 and no. 19), or on the left edge of the roof of no. 17?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64515"></a>64515</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64516"></a>64516</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64518"></a>64518</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64519"></a>64519</td>
<td class="instruction">CP 206</td>
<td class="comment-11" rowspan="1">Is it less than 206 (meaning the character is standing on the right edge of the roof of the apartment building next to no. 74)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64521"></a>64521</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64522"></a>64522</td>
<td class="instruction">JR NZ,64534</td>
<td class="comment-11" rowspan="1">Jump unless the character's x-coordinate is 206</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64524"></a>
<div class="comments">
<div class="paragraph">
The character is standing on the right edge of the roof the apartment building next to no. 19, or the left edge of the roof of no. 17.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64524"></a>64524</td>
<td class="instruction">LD A,(47386)</td>
<td class="comment-11" rowspan="1">Collect the Z value for 208&lt;=x&lt;=215, 6&lt;=y&lt;=11 from the block at <a class="link" href="47360.html">47360</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64527"></a>64527</td>
<td class="instruction">CP 11</td>
<td class="comment-11" rowspan="1">Is there a rope connecting the roofs of no. 17 and the apartment building next to no. 19 (in which case <span class="register">A</span>=9)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64529"></a>64529</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64530"></a>64530</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Drop the return address (<a class="link" href="64338.html#64341">64341</a>) from the stack</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64531"></a>64531</td>
<td class="instruction">JP <a class="link" href="60347.html#60423">60423</a></td>
<td class="comment-11" rowspan="1">Move the character midstride</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64534"></a>
<div class="comments">
<div class="paragraph">
The character is standing on the left edge of the roof of no. 17.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64534"></a>64534</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64535"></a>64535</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is the character facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64537"></a>64537</td>
<td class="instruction">JR Z,64524</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64539"></a>
<div class="comments">
<div class="paragraph">
The character is about to move right, away from the left edge of the roof of no. 17.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64539"></a>64539</td>
<td class="instruction">LD A,(47386)</td>
<td class="comment-11" rowspan="1">Collect the Z value for 208&lt;=x&lt;=215, 6&lt;=y&lt;=11 from the block at <a class="link" href="47360.html">47360</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64542"></a>64542</td>
<td class="instruction">CP 11</td>
<td class="comment-11" rowspan="1">Is there a rope connecting the roofs of no. 17 and the apartment building next to no. 19 (in which case <span class="register">A</span>=9)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64544"></a>64544</td>
<td class="instruction">CALL NZ,<a class="link" href="64549.html">64549</a></td>
<td class="comment-11" rowspan="1">Remove it if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64547"></a>64547</td>
<td class="instruction">JR 64530</td>
<td class="comment-11" rowspan="1">Move the character midstride</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="64338.html">64338</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#64512">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="64549.html">64549</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>