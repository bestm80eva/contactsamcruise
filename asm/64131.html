<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 64131</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="64130.html">64130</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#64131">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="64162.html">64162</a></span></td>
</tr>
</table>
<div class="description">64131: Deal with a character who has nearly recovered from being knocked over</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="64005.html">64005</a>. Controls a character from the point where he has almost recovered from the daze of being knocked over.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-229)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64131"></a>64131</td>
<td class="instruction">CALL <a class="link" href="63994.html">63994</a></td>
<td class="comment-11" rowspan="1">Place the address of the next instruction into bytes 18 and 19 of the character's buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64134"></a>
<div class="comments">
<div class="paragraph">
The apparent intention of the remainder of this routine is to make the character return (by walking backwards or forwards as required) to the spot where he was hit, but this fails to happen because of the faulty 'JR NZ' instruction below, which should be a 'JR Z' instead.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64134"></a>64134</td>
<td class="instruction">LD L,21</td>
<td class="comment-11" rowspan="2">Collect the character's pre-knockout x-coordinate from byte 21 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64136"></a>64136</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64137"></a>64137</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="2">Does it match the character's current x-coordinate?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64139"></a>64139</td>
<td class="instruction">CP (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64140"></a>64140</td>
<td class="instruction">JR NZ,64150</td>
<td class="comment-11" rowspan="1">Jump if not (this is a <a class="link" href="../reference/bugs.html#pttd">bug</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64142"></a>64142</td>
<td class="instruction">LD C,128</td>
<td class="comment-11" rowspan="1">Bit 7 set, bit 6 reset: the character will move left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64144"></a>64144</td>
<td class="instruction">JR C,<a class="link" href="64005.html#64080">64080</a></td>
<td class="comment-11" rowspan="1">This jump is never made, but the intention was to make it if the character's current x-coordinate is greater than his pre-knockout x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64146"></a>64146</td>
<td class="instruction">LD C,64</td>
<td class="comment-11" rowspan="1">Bit 7 reset, bit 6 set: the character will move right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64148"></a>64148</td>
<td class="instruction">JR <a class="link" href="64005.html#64080">64080</a></td>
<td class="comment-11" rowspan="1">Move the character right</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64150"></a>
<div class="comments">
<div class="paragraph">
Restore the character's pre-knockout animatory state and terminate this subcommand.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64150"></a>64150</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for the character's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64153"></a>64153</td>
<td class="instruction">LD L,13</td>
<td class="comment-11" rowspan="2">Collect the character's pre-knockout animatory state from byte 13 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64155"></a>64155</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64156"></a>64156</td>
<td class="instruction">CALL <a class="link" href="59861.html">59861</a></td>
<td class="comment-11" rowspan="1">Update the character's animatory state and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64159"></a>64159</td>
<td class="instruction">JP <a class="link" href="62080.html#62088">62088</a></td>
<td class="comment-11" rowspan="1">Terminate this uninterruptible subcommand</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="64130.html">64130</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#64131">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="64162.html">64162</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>