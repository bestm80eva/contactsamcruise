<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 25789</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25784.html">25784</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25789">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25918.html">25918</a></span></td>
</tr>
</table>
<div class="description">25789: 'S' pressed - somersault</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this routine is found in the table of keypress handling routines at <a class="link" href="60672.html">60672</a>. It is called from the main loop at <a class="link" href="61483.html">61483</a> when 'S' is pressed.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25789"></a>25789</td>
<td class="instruction">LD HL,25748</td>
<td class="comment-11" rowspan="1">The animation phase table for Sam when somersaulting is at <a class="link" href="25748.html">25748</a></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25792"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="25784.html">25784</a> with <span class="register">HL</span>=<a class="link" href="25724.html">25724</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25792"></a>25792</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the address of the animation phase table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25793"></a>25793</td>
<td class="instruction">CALL <a class="link" href="25918.html">25918</a></td>
<td class="comment-11" rowspan="1">Return to the main loop if Sam cannot roll or somersault from his current location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25796"></a>25796</td>
<td class="instruction">LD A,8</td>
<td class="comment-11" rowspan="2">Set bit 3 of Sam's status flags at <a class="link" href="32764.html">32764</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25798"></a>25798</td>
<td class="instruction">LD (32764),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25801"></a>25801</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the address of the animation phase table to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25802"></a>25802</td>
<td class="instruction">LD (58892),HL</td>
<td class="comment-11" rowspan="1">Copy the address of the animation phase table into bytes 12 and 13 of Sam's buffer</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25805"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="29912.html">29912</a> when bit 3 at <a class="link" href="32764.html">32764</a> is set (by this routine - see above).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25805"></a>25805</td>
<td class="instruction">LD HL,58888</td>
<td class="comment-11" rowspan="2">Reset Sam's main action timer (in byte 8 of his buffer) to 6</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25808"></a>25808</td>
<td class="instruction">LD (HL),6</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25810"></a>25810</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25813"></a>25813</td>
<td class="instruction">LD HL,(58892)</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first byte of the current entry in the animation phase table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25816"></a>25816</td>
<td class="instruction">AND 128</td>
<td class="comment-11" rowspan="1">Set the zero flag if Sam is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25818"></a>25818</td>
<td class="instruction">LD B,A</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=0 if Sam is facing left, 128 if facing right</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25819"></a>25819</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=first byte of the animation phase table entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25820"></a>25820</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the second byte in the entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25821"></a>25821</td>
<td class="instruction">JR Z,25824</td>
<td class="comment-11" rowspan="1">Jump if Sam is facing left</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25823"></a>25823</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=second byte of the animation phase table entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25824"></a>25824</td>
<td class="instruction">ADD A,E</td>
<td class="comment-11" rowspan="1">Add Sam's current x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25825"></a>25825</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=Sam's next x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25826"></a>25826</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=third byte of the animation phase table entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25827"></a>25827</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25828"></a>25828</td>
<td class="instruction">ADD A,D</td>
<td class="comment-11" rowspan="1">Add Sam's current y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25829"></a>25829</td>
<td class="instruction">LD D,A</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=Sam's next y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25830"></a>25830</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=fourth byte of the animation phase table entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25831"></a>25831</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25832"></a>25832</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first byte of the next entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25833"></a>25833</td>
<td class="instruction">LD (58892),HL</td>
<td class="comment-11" rowspan="1">Store this address in bytes 12 and 13 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25836"></a>25836</td>
<td class="instruction">RLCA</td>
<td class="comment-11" rowspan="4"><span class="register">C</span>=Sam's next base animatory state (bit 7 reset)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25837"></a>25837</td>
<td class="instruction">AND A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25838"></a>25838</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25839"></a>25839</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25840"></a>25840</td>
<td class="instruction">JR NC,25877</td>
<td class="comment-11" rowspan="1">Jump unless it's time to check whether Sam has landed</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25842"></a>
<div class="comments">
<div class="paragraph">
It's time to check whether Sam has landed on his feet yet.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25842"></a>25842</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">Save Sam's new coordinates briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25843"></a>25843</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is Sam's next animatory state <a class="link" href="../graphics/as.html#0">0 or 128</a> (standing upright)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25844"></a>25844</td>
<td class="instruction">JR Z,25853</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25846"></a>25846</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="1">Subtract 1 from Sam's new x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25847"></a>25847</td>
<td class="instruction">BIT 7,B</td>
<td class="comment-11" rowspan="1">Is Sam facing left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25849"></a>25849</td>
<td class="instruction">JR Z,25853</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25851"></a>25851</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="2">Add 1 to Sam's new x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25852"></a>25852</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25853"></a>25853</td>
<td class="instruction">CALL <a class="link" href="60152.html#60159">60159</a></td>
<td class="comment-11" rowspan="1">Has Sam landed on the sidewalk or the road yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25856"></a>25856</td>
<td class="instruction">JR NC,25866</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25858"></a>25858</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's adjusted new x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25859"></a>25859</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore Sam's new x-coordinate to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25860"></a>25860</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Add 1 to Sam's new y-coordinate (move him down a level)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25861"></a>25861</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">Save Sam's adjusted new coordinates briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25862"></a>25862</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=Sam's adjusted new x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25863"></a>25863</td>
<td class="instruction">CALL <a class="link" href="60152.html#60159">60159</a></td>
<td class="comment-11" rowspan="1">Set the carry flag unless Sam has landed on the sidewalk or road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25866"></a>25866</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore Sam's adjusted new y-coordinate to <span class="register">D</span>, and his new x-coordinate to <span class="register">E</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25867"></a>25867</td>
<td class="instruction">JR C,25876</td>
<td class="comment-11" rowspan="1">Jump if Sam has not landed yet</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25869"></a>25869</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's next base animatory state (bit 7 reset)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25870"></a>25870</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is it <a class="link" href="../graphics/as.html#0">0 or 128</a> (standing upright)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25871"></a>25871</td>
<td class="instruction">JR NZ,25876</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25873"></a>25873</td>
<td class="instruction">LD (32764),A</td>
<td class="comment-11" rowspan="1">Clear all of Sam's status flags at <a class="link" href="32764.html">32764</a> (Sam has landed)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25876"></a>25876</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's next base animatory state (bit 7 reset)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25877"></a>25877</td>
<td class="instruction">CP 9</td>
<td class="comment-11" rowspan="1">Is the new base animatory state &lt; 9 (meaning Sam has just started or is just finishing a roll or somersault)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25879"></a>25879</td>
<td class="instruction">JR C,25893</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25881"></a>25881</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save Sam's direction indicator and next base animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25882"></a>25882</td>
<td class="instruction">PUSH DE</td>
<td class="comment-11" rowspan="1">Save Sam's next x- and y-coordinates</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25883"></a>25883</td>
<td class="instruction">CP 15</td>
<td class="comment-11" rowspan="1">Is the new base animatory state <a class="link" href="../graphics/as.html#15">15</a> (meaning Sam is going to rotate 90 degrees for the first part of the roll or somersault)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25885"></a>25885</td>
<td class="instruction">CALL Z,<a class="link" href="25618.html">25618</a></td>
<td class="comment-11" rowspan="1">If so, prepare sprite tiles 239-247 for this animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25888"></a>25888</td>
<td class="instruction">CALL NZ,<a class="link" href="25618.html#25672">25672</a></td>
<td class="comment-11" rowspan="1">Otherwise, rotate sprite tiles 239-247 for animatory state <a class="link" href="../graphics/as.html#9">9</a>, <a class="link" href="../graphics/as.html#31">31</a> or <a class="link" href="../graphics/as.html#10">10</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25891"></a>25891</td>
<td class="instruction">POP DE</td>
<td class="comment-11" rowspan="1">Restore Sam's next x- and y-coordinates to <span class="register">E</span> and <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25892"></a>25892</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore Sam's direction indicator and next base animatory state to <span class="register">B</span> and <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25893"></a>25893</td>
<td class="instruction">LD H,230</td>
<td class="comment-11" rowspan="1">230=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25895"></a>25895</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=Sam's new animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25896"></a>25896</td>
<td class="instruction">OR C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25897"></a>25897</td>
<td class="instruction">CALL <a class="link" href="59861.html">59861</a></td>
<td class="comment-11" rowspan="1">Update Sam's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25900"></a>25900</td>
<td class="instruction">LD A,(32764)</td>
<td class="comment-11" rowspan="1">Collect Sam's status flags from <a class="link" href="32764.html">32764</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25903"></a>25903</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has Sam landed yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25904"></a>25904</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25905"></a>25905</td>
<td class="instruction">CALL <a class="link" href="60521.html">60521</a></td>
<td class="comment-11" rowspan="1">Make a sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25908"></a>25908</td>
<td class="instruction">LD L,12</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 12 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25910"></a>25910</td>
<td class="instruction">CALL <a class="link" href="25539.html">25539</a></td>
<td class="comment-11" rowspan="1">Check whether Sam has somersaulted onto a banknote</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25913"></a>25913</td>
<td class="instruction">LD H,230</td>
<td class="comment-11" rowspan="1">230=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25915"></a>25915</td>
<td class="instruction">JP <a class="link" href="60539.html#60547">60547</a></td>
<td class="comment-11" rowspan="1">Now that Sam has landed, scroll the screen left or right if necessary</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25784.html">25784</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25789">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25918.html">25918</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>