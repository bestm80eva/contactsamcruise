<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 62976</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="62971.html">62971</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#62976">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63110.html">63110</a></span></td>
</tr>
</table>
<div class="description">62976: Make a character go to a location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by many command lists to make a character go to a specified place.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-229)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62976"></a>62976</td>
<td class="instruction">CALL <a class="link" href="31944.html">31944</a></td>
<td class="comment-11" rowspan="1">Collect the destination coordinates from the command list</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62979"></a>62979</td>
<td class="instruction">JR 62998</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62981"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the command lists at <a class="link" href="25066.html">25066</a>, <a class="link" href="64756.html">64756</a>, <a class="link" href="64790.html">64790</a>, <a class="link" href="64816.html">64816</a>, <a class="link" href="64846.html">64846</a>, <a class="link" href="64878.html">64878</a> and <a class="link" href="64902.html">64902</a> to make a character carry Sam to a location.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62981"></a>62981</td>
<td class="instruction">CALL <a class="link" href="31944.html">31944</a></td>
<td class="comment-11" rowspan="1">Collect the destination coordinates from the command list</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62984"></a>62984</td>
<td class="instruction">LD (HL),10</td>
<td class="comment-11" rowspan="1">Change the address of the primary command routine in bytes 8 and 9 of the character's buffer to <a class="link" href="62976.html#62986">62986</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62986"></a>62986</td>
<td class="instruction">CALL <a class="link" href="63128.html">63128</a></td>
<td class="comment-11" rowspan="1">Exit now if the character is midstride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62989"></a>62989</td>
<td class="instruction">CALL <a class="link" href="60812.html">60812</a></td>
<td class="comment-11" rowspan="1">Determine the next move the character should make to reach his destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62992"></a>62992</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has the character reached his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62993"></a>62993</td>
<td class="instruction">JR Z,63007</td>
<td class="comment-11" rowspan="1">Move to the next command in the command list if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62995"></a>62995</td>
<td class="instruction">JP <a class="link" href="29361.html#29479">29479</a></td>
<td class="comment-11" rowspan="1">Move the character one step towards his destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62998"></a>
<div class="comments">
<div class="paragraph">
The character is not carrying Sam.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62998"></a>62998</td>
<td class="instruction">LD (HL),24</td>
<td class="comment-11" rowspan="1">Change the address of the primary command routine in bytes 8 and 9 of the character's buffer to <a class="link" href="62976.html#63000">63000</a> (below)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63000"></a>63000</td>
<td class="instruction">CALL <a class="link" href="63128.html">63128</a></td>
<td class="comment-11" rowspan="1">Exit now if the character is midstride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63003"></a>63003</td>
<td class="instruction">CALL <a class="link" href="60812.html">60812</a></td>
<td class="comment-11" rowspan="1">Determine the next move the character should make to reach his destination</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63006"></a>63006</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has the character reached his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63007"></a>63007</td>
<td class="instruction">JP Z,<a class="link" href="62080.html">62080</a></td>
<td class="comment-11" rowspan="1">Move to the next command in the command list if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63010"></a>63010</td>
<td class="instruction">CP 5</td>
<td class="comment-11" rowspan="1">Is the character standing next to a closed door?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63012"></a>63012</td>
<td class="instruction">JR NC,63100</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63014"></a>63014</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save the direction indicator</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63015"></a>63015</td>
<td class="instruction">LD BC,62926</td>
<td class="comment-11" rowspan="1">Point <span class="register">BC</span> at the interruptible subcommand routine at <a class="link" href="62926.html">62926</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63018"></a>63018</td>
<td class="instruction">LD L,13</td>
<td class="comment-11" rowspan="2">Pick up the location/destination indicator from byte 13 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63020"></a>63020</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63021"></a>63021</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is the character on the sidewalk or the road (or on the front steps of the hotel but heading somewhere other than the hotel)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63022"></a>63022</td>
<td class="instruction">JR NZ,63051</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63024"></a>63024</td>
<td class="instruction">LD BC,62971</td>
<td class="comment-11" rowspan="1">Point <span class="register">BC</span> at the interruptible subcommand routine at <a class="link" href="62971.html">62971</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63027"></a>63027</td>
<td class="instruction">LD L,16</td>
<td class="comment-11" rowspan="2">Place the x- or y-coordinate of the character's intermediate destination into byte 16 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63029"></a>63029</td>
<td class="instruction">LD (HL),E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63030"></a>63030</td>
<td class="instruction">LD L,15</td>
<td class="comment-11" rowspan="4">Copy the interruptible subcommand routine address in <span class="register">BC</span> (<a class="link" href="62892.html">62892</a>, <a class="link" href="62926.html">62926</a> or <a class="link" href="62971.html">62971</a>) into bytes 14 and 15 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63032"></a>63032</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63033"></a>63033</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63034"></a>63034</td>
<td class="instruction">LD (HL),C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63035"></a>63035</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the direction indicator (1-4) to <span class="register">A</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63036"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="29361.html">29361</a> and <a class="link" href="31362.html">31362</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63036"></a>63036</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Does the character need to move right next to reach his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63037"></a>63037</td>
<td class="instruction">JP Z,<a class="link" href="60334.html">60334</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63040"></a>63040</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Does the character need to move left?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63041"></a>63041</td>
<td class="instruction">JP Z,<a class="link" href="60347.html">60347</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63044"></a>63044</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Does the character need to move up?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63045"></a>63045</td>
<td class="instruction">JP Z,<a class="link" href="60315.html">60315</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63048"></a>63048</td>
<td class="instruction">JP <a class="link" href="60320.html">60320</a></td>
<td class="comment-11" rowspan="1">Make the character move down</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63051"></a>
<div class="comments">
<div class="paragraph">
The character is not on the sidewalk or road.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63051"></a>63051</td>
<td class="instruction">DEC A</td>
<td class="comment-11" rowspan="1">Is the character's destination in a region other than the one he's in at the moment?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63052"></a>63052</td>
<td class="instruction">JR NZ,63083</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63054"></a>63054</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="2">Collect the character's y-coordinate from byte 2 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63056"></a>63056</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63057"></a>63057</td>
<td class="instruction">CP 31</td>
<td class="comment-11" rowspan="1">Is the character on or below the level of the first floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63059"></a>63059</td>
<td class="instruction">JR NC,63074</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63061"></a>63061</td>
<td class="instruction">LD L,10</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 10 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63063"></a>63063</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=character's destination x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63064"></a>63064</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=11</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63065"></a>63065</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Is the character's y-coordinate the same as that of his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63066"></a>63066</td>
<td class="instruction">JR Z,63027</td>
<td class="comment-11" rowspan="1">If so, send the character to his destination x-coordinate (on the same floor)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63068"></a>63068</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=character's destination y-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63069"></a>63069</td>
<td class="instruction">LD BC,62892</td>
<td class="comment-11" rowspan="1">Point <span class="register">BC</span> at the interruptible subcommand routine at <a class="link" href="62892.html">62892</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63072"></a>63072</td>
<td class="instruction">JR 63027</td>
<td class="comment-11" rowspan="1">Send the character up or down the stairs towards his destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63074"></a>
<div class="comments">
<div class="paragraph">
The character is in the same region as his destination, and on or below the level of the first floor.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63074"></a>63074</td>
<td class="instruction">LD L,4</td>
<td class="comment-11" rowspan="1">Byte 4 of the character's buffer holds his z-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63076"></a>63076</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Is the character indoors (z=1)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63078"></a>63078</td>
<td class="instruction">CALL NZ,<a class="link" href="62597.html">62597</a></td>
<td class="comment-11" rowspan="1">If so, make him consider flipping a light switch</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63081"></a>63081</td>
<td class="instruction">JR 63035</td>
<td class="comment-11" rowspan="1">Move the character one step closer to his destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63083"></a>
<div class="comments">
<div class="paragraph">
The character's destination is in a region other than the one he's in at the moment.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63083"></a>63083</td>
<td class="instruction">LD L,2</td>
<td class="comment-11" rowspan="2">Collect the character's y-coordinate from byte 2 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63085"></a>63085</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63086"></a>63086</td>
<td class="instruction">LD E,31</td>
<td class="comment-11" rowspan="1">31 is the y-coordinate of the first floor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63088"></a>63088</td>
<td class="instruction">CP E</td>
<td class="comment-11" rowspan="1">Is the character above the first floor?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63089"></a>63089</td>
<td class="instruction">JR C,63069</td>
<td class="comment-11" rowspan="1">Jump if so to send him down to the first floor</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63091"></a>63091</td>
<td class="instruction">LD L,4</td>
<td class="comment-11" rowspan="1">Byte 4 of the character's buffer holds his z-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63093"></a>63093</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Is the character indoors (z=1)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63095"></a>63095</td>
<td class="instruction">CALL NZ,<a class="link" href="62880.html">62880</a></td>
<td class="comment-11" rowspan="1">If so, make him consider flipping a light switch off before leaving</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63098"></a>63098</td>
<td class="instruction">JR 63035</td>
<td class="comment-11" rowspan="1">Move the character one step closer to his destination</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="63100"></a>
<div class="comments">
<div class="paragraph">
The character is standing next to a closed door. This entry point is used by the routines at <a class="link" href="29361.html">29361</a> and <a class="link" href="31362.html">31362</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63100"></a>63100</td>
<td class="instruction">JP Z,<a class="link" href="62216.html#62252">62252</a></td>
<td class="comment-11" rowspan="1">Jump if the character is standing behind a closed door</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63103"></a>63103</td>
<td class="instruction">LD L,15</td>
<td class="comment-11" rowspan="2">Prepare the MSB of the address of the interruptible subcommand routine at <a class="link" href="62278.html">62278</a> in byte 15 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63105"></a>63105</td>
<td class="instruction">LD (HL),243</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63107"></a>63107</td>
<td class="instruction">JP <a class="link" href="62264.html">62264</a></td>
<td class="comment-11" rowspan="1">Prepare the LSB and raise the character's arm</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="62971.html">62971</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#62976">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63110.html">63110</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>