<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 63784</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63774.html">63774</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63784">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63837.html">63837</a></span></td>
</tr>
</table>
<div class="description">63784: Prepare the sprite tiles used by a character when lying down</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="63954.html">63954</a>. Builds rotated copies of the sprite tiles in the bottom four rows of the leftmost and middle columns of the character's base animatory state and places them in the slots for sprite tiles 248-255 (which are used by the animatory state of the character lying down).
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Character's base animatory state</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63784"></a>63784</td>
<td class="instruction">OR 130</td>
<td class="comment-11" rowspan="3">Point <span class="register">HL</span> at the reference for tile 0 of the character's base animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63786"></a>63786</td>
<td class="instruction">LD L,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63787"></a>63787</td>
<td class="instruction">LD H,215</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63789"></a>63789</td>
<td class="instruction">LD E,247</td>
<td class="comment-11" rowspan="1">The animatory states of the characters lying down use sprite tiles 248-255; initialise the tile reference counter now</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63791"></a>63791</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the next source sprite tile reference</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63792"></a>63792</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="1">Increment the tile reference counter</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63793"></a>63793</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if we've rotated all 8 sprite tiles</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63794"></a>63794</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=target sprite tile reference (248-255)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63795"></a>63795</td>
<td class="instruction">CP 252</td>
<td class="comment-11" rowspan="1">Have we just finished rotating the tiles in the leftmost column of the source sprite?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63797"></a>63797</td>
<td class="instruction">JR NZ,63800</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63799"></a>63799</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=221 (where the reference for sprite tile 6 is located)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63800"></a>63800</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the source sprite tile reference pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63801"></a>63801</td>
<td class="instruction">LD D,199</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at where we will place the graphic data for the rotated sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63803"></a>63803</td>
<td class="instruction">LD L,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=source sprite tile reference</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63804"></a>63804</td>
<td class="instruction">LD B,8</td>
<td class="comment-11" rowspan="1">There are 8 pairs of graphic and mask bytes to rotate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63806"></a>63806</td>
<td class="instruction">LD H,197</td>
<td class="comment-11" rowspan="1">Initialise the source sprite tile pointer for rotating graphic data</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63808"></a>63808</td>
<td class="instruction">LD A,128</td>
<td class="comment-11" rowspan="1">Set bit 7 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63810"></a>63810</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="5">Collect a pixel column from the source sprite tile's graphic data</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63811"></a>63811</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63812"></a>63812</td>
<td class="instruction">RLC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63814"></a>63814</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63815"></a>63815</td>
<td class="instruction">JR NC,63810</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63817"></a>63817</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Insert the pixel column of graphic data as a pixel row into the target sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63818"></a>63818</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the corresponding pixel row of mask data in the target sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63819"></a>63819</td>
<td class="instruction">LD H,198</td>
<td class="comment-11" rowspan="1">Initialise the source sprite tile pointer for rotating mask data</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63821"></a>63821</td>
<td class="instruction">LD A,128</td>
<td class="comment-11" rowspan="1">Set bit 7 of <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="63823"></a>63823</td>
<td class="instruction">INC H</td>
<td class="comment-11" rowspan="5">Collect a pixel column from the source sprite tile's mask data</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63824"></a>63824</td>
<td class="instruction">INC H</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63825"></a>63825</td>
<td class="instruction">RLC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63827"></a>63827</td>
<td class="instruction">RRA</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63828"></a>63828</td>
<td class="instruction">JR NC,63823</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63830"></a>63830</td>
<td class="instruction">LD (DE),A</td>
<td class="comment-11" rowspan="1">Insert the pixel column of mask data as a pixel row into the target sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63831"></a>63831</td>
<td class="instruction">INC D</td>
<td class="comment-11" rowspan="1">Point <span class="register">DE</span> at the next pixel row of graphic data in the target sprite tile</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63832"></a>63832</td>
<td class="instruction">DJNZ 63806</td>
<td class="comment-11" rowspan="1">Jump back until we've done all 8 pairs of graphic and mask bytes</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63834"></a>63834</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the source sprite tile reference pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="63835"></a>63835</td>
<td class="instruction">JR 63791</td>
<td class="comment-11" rowspan="1">Jump back to build the next rotated sprite tile</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="63774.html">63774</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#63784">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="63837.html">63837</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>