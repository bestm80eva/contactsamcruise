<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 31362</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="31338.html">31338</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31362">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31413.html">31413</a></span></td>
</tr>
</table>
<div class="description">31362: Make a gangster chase and pick up Sam</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="25385.html">25385</a>. Makes a gangster start or continue chasing Sam if appropriate. Whether the gangster continues to chase Sam depends on Sam's and the gangster's locations relative to the two regions defined in the gangster's region definition table. If Sam has left the first region, the gangster gives up the chase and restarts his command list; if the gangster has already chased Sam to the boundary of the second region, he will stand on guard there; and if the gangster is close enough to Sam to pick him up, he will do so and move to the next command in the command list.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Gangster's character number (215-224)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31362"></a>31362</td>
<td class="instruction">CALL <a class="link" href="25074.html">25074</a></td>
<td class="comment-11" rowspan="1">Is the gangster close enough to Sam to pick him up?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31365"></a>31365</td>
<td class="instruction">JP C,<a class="link" href="29149.html">29149</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31368"></a>31368</td>
<td class="instruction">CALL <a class="link" href="63128.html">63128</a></td>
<td class="comment-11" rowspan="1">Exit now if the gangster is midstride</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31371"></a>31371</td>
<td class="instruction">LD L,23</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 23 of the gangster's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31373"></a>31373</td>
<td class="instruction">LD E,(HL)</td>
<td class="comment-11" rowspan="3">Collect the command list start address in <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31374"></a>31374</td>
<td class="instruction">INC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31375"></a>31375</td>
<td class="instruction">LD D,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31376"></a>31376</td>
<td class="instruction">LD B,H</td>
<td class="comment-11" rowspan="1"><span class="register">B</span>=gangster's character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31377"></a>31377</td>
<td class="instruction">LD HL,65526</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the relevant table of region definitions (<a class="link" href="64780.html">64780</a>, <a class="link" href="64806.html">64806</a>, <a class="link" href="64836.html">64836</a>, <a class="link" href="64868.html">64868</a> or <a class="link" href="64892.html">64892</a>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31380"></a>31380</td>
<td class="instruction">ADD HL,DE</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31381"></a>31381</td>
<td class="instruction">LD D,230</td>
<td class="comment-11" rowspan="1">230=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31383"></a>31383</td>
<td class="instruction">CALL <a class="link" href="29578.html">29578</a></td>
<td class="comment-11" rowspan="1">Check whether Sam is inside the first region</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31386"></a>31386</td>
<td class="instruction">LD D,B</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=gangster's character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31387"></a>31387</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=gangster's character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31388"></a>31388</td>
<td class="instruction">JP C,<a class="link" href="63198.html">63198</a></td>
<td class="comment-11" rowspan="1">Restart the command list if Sam is outside the first region</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31391"></a>31391</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=gangster's character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31392"></a>31392</td>
<td class="instruction">CALL <a class="link" href="29578.html">29578</a></td>
<td class="comment-11" rowspan="1">Check whether the gangster is inside the second region</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31395"></a>31395</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if he's outside the second region</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31396"></a>
<div class="comments">
<div class="paragraph">
Sam is inside the first region, and the gangster hasn't reached the boundary of the second region, so the chase is still on.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31396"></a>31396</td>
<td class="instruction">LD H,B</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=gangster's character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31397"></a>31397</td>
<td class="instruction">CALL <a class="link" href="29072.html">29072</a></td>
<td class="comment-11" rowspan="1">Set the gangster's destination to Sam's current location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31400"></a>31400</td>
<td class="instruction">CALL <a class="link" href="60812.html">60812</a></td>
<td class="comment-11" rowspan="1">Determine the next move the gangster should make to reach Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31403"></a>31403</td>
<td class="instruction">CP 5</td>
<td class="comment-11" rowspan="1">Is the gangster standing next to a closed door?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31405"></a>31405</td>
<td class="instruction">JP NC,<a class="link" href="62976.html#63100">63100</a></td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31408"></a>31408</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Has the gangster reached his destination?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31409"></a>31409</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31410"></a>31410</td>
<td class="instruction">JP <a class="link" href="62976.html#63036">63036</a></td>
<td class="comment-11" rowspan="1">Move the gangster one step closer to Sam</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="31338.html">31338</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#31362">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31413.html">31413</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>