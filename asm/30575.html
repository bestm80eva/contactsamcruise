<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 30575</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30574.html">30574</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30575">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="30626.html">30626</a></span></td>
</tr>
</table>
<div class="description">30575: Deal with Sam when he's on the phone and has been asked 'WHO'S THERE?'</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="30675.html">30675</a>. Waits for a keypress, and then queues message <a class="link" href="27122.html">40</a> (''{name}' I SAID ') followed by either message <a class="link" href="27204.html">46</a> ('I DUNNO NO {name}') or the message Sam is supposed to receive upon giving the correct name.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30575"></a>30575</td>
<td class="instruction">CALL <a class="link" href="61923.html">61923</a></td>
<td class="comment-11" rowspan="1">Check for keypresses or hang up the phone</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30578"></a>30578</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if no key with an ASCII code in the range 48-127 was pressed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30579"></a>30579</td>
<td class="instruction">CP 97</td>
<td class="comment-11" rowspan="1">Is the ASCII code of the keypress less than 97 ('a')?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30581"></a>30581</td>
<td class="instruction">RET C</td>
<td class="comment-11" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30582"></a>30582</td>
<td class="instruction">CP 104</td>
<td class="comment-11" rowspan="1">Is the ASCII code of the keypress less than 104 ('h')?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30584"></a>30584</td>
<td class="instruction">JR C,30591</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30586"></a>30586</td>
<td class="instruction">CP 115</td>
<td class="comment-11" rowspan="1">Was 's' pressed?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30588"></a>30588</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30589"></a>30589</td>
<td class="instruction">SUB 11</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=104</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30591"></a>30591</td>
<td class="instruction">ADD A,7</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=104-111 (message number of a name)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30593"></a>30593</td>
<td class="instruction">LD (32720),A</td>
<td class="comment-11" rowspan="1">Store this at <a class="link" href="32720.html">32720</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30596"></a>30596</td>
<td class="instruction">PUSH AF</td>
<td class="comment-11" rowspan="1">Save the name message number briefly</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30597"></a>30597</td>
<td class="instruction">LD A,40</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="27122.html">40</a>: ''{name}' I SAID '</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30599"></a>30599</td>
<td class="instruction">CALL <a class="link" href="30154.html">30154</a></td>
<td class="comment-11" rowspan="1">Queue this message urgently</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30602"></a>30602</td>
<td class="instruction">LD HL,(32663)</td>
<td class="comment-11" rowspan="1">Collect from <a class="link" href="32663.html">32663</a> the address of either the second byte of the relevant phone table entry (if the phone was ringing, or the person Sam's calling has a message for him), or the final byte of the phone message table at <a class="link" href="27506.html">27506</a> (if the person Sam's calling has no message for him); the final byte of the phone message table is 255, which does not match the message number of any name</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30605"></a>30605</td>
<td class="instruction">POP AF</td>
<td class="comment-11" rowspan="1">Restore the name message number to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30606"></a>30606</td>
<td class="instruction">CP (HL)</td>
<td class="comment-11" rowspan="1">Set the zero flag if Sam has used the correct name</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30607"></a>30607</td>
<td class="instruction">LD A,46</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="27204.html">46</a>: 'I DUNNO NO {name}'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30609"></a>30609</td>
<td class="instruction">JR NZ,30617</td>
<td class="comment-11" rowspan="1">Jump unless Sam has used the correct name</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="30611"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="30627.html">30627</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30611"></a>30611</td>
<td class="instruction">DEC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the first byte of the phone entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30612"></a>30612</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-11" rowspan="1">Mark the phone entry inactive</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30614"></a>30614</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="2">Point <span class="register">HL</span> at the third byte of the phone entry</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30615"></a>30615</td>
<td class="instruction">INC HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30616"></a>30616</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=telephone message number</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="30617"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routines at <a class="link" href="30627.html">30627</a> (with <span class="register">A</span>=<a class="link" href="27150.html">43</a>, <a class="link" href="27165.html">44</a>, <a class="link" href="27193.html">45</a> or <a class="link" href="27271.html">50</a>) and <a class="link" href="30675.html">30675</a> (with <span class="register">A</span>=<a class="link" href="27214.html">47</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30617"></a>30617</td>
<td class="instruction">LD HL,512</td>
<td class="comment-11" rowspan="2">Clear <a class="link" href="32666.html">32666</a> and set bit 1 of the telephone call status flags at <a class="link" href="32667.html">32667</a> (to disconnect the call)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30620"></a>30620</td>
<td class="instruction">LD (32666),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30623"></a>30623</td>
<td class="instruction">JP <a class="link" href="30154.html">30154</a></td>
<td class="comment-11" rowspan="1">Queue the telephone message urgently</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30574.html">30574</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30575">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="30626.html">30626</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20140614</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>