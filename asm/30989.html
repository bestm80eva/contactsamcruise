<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 30989</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30972.html">30972</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30989">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31100.html">31100</a></span></td>
</tr>
</table>
<div class="description">30989: Display a cutscene</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="31414.html">31414</a>. Displays a cutscene, and then enters demo mode or resumes the game in the next mode.
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Cutscene message number</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30989"></a>30989</td>
<td class="instruction">LD (32722),A</td>
<td class="comment-11" rowspan="1">Store the cutscene message number at <a class="link" href="32722.html">32722</a> so that it can be monitored</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30992"></a>30992</td>
<td class="instruction">CALL <a class="link" href="28357.html">28357</a></td>
<td class="comment-11" rowspan="1">Add the message to the message queue</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30995"></a>30995</td>
<td class="instruction">XOR A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30996"></a>30996</td>
<td class="instruction">LD (32713),A</td>
<td class="comment-11" rowspan="1">Set Sam's disguise ID (stored at <a class="link" href="32713.html">32713</a>) to 0 (none)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30999"></a>30999</td>
<td class="instruction">LD (32666),A</td>
<td class="comment-11" rowspan="1">Disconnect any phone call Sam may be making by setting <a class="link" href="32666.html">32666</a> to 0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31002"></a>31002</td>
<td class="instruction">LD (32764),A</td>
<td class="comment-11" rowspan="1">Clear all of Sam's status flags at <a class="link" href="32764.html">32764</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31005"></a>31005</td>
<td class="instruction">CALL <a class="link" href="63838.html#63849">63849</a></td>
<td class="comment-11" rowspan="1">Update Sam's sprite and the disguise icon now that Sam's wearing no disguise</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31008"></a>
<div class="comments">
<div class="paragraph">
The loop that follows makes Sam pace up and down until the cutscene is over.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31008"></a>31008</td>
<td class="instruction">LD HL,58889</td>
<td class="comment-11" rowspan="3">Reset the midstride/mid-action timer in byte 9 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31011"></a>31011</td>
<td class="instruction">XOR A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31012"></a>31012</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31013"></a>31013</td>
<td class="instruction">LD L,A</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31014"></a>31014</td>
<td class="instruction">BIT 0,(HL)</td>
<td class="comment-11" rowspan="1">Is Sam midstride?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31016"></a>31016</td>
<td class="instruction">JR Z,31058</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31018"></a>31018</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31021"></a>31021</td>
<td class="instruction">DEC E</td>
<td class="comment-11" rowspan="5">Set <span class="register">E</span> to Sam's next x-coordinate (immediately in front of him)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31022"></a>31022</td>
<td class="instruction">BIT 7,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31024"></a>31024</td>
<td class="instruction">JR Z,31028</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31026"></a>31026</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31027"></a>31027</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31028"></a>31028</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="2">Set <span class="register">A</span> to Sam's new animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31029"></a>31029</td>
<td class="instruction">AND 251</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31031"></a>31031</td>
<td class="instruction">CALL <a class="link" href="59861.html">59861</a></td>
<td class="comment-11" rowspan="1">Update Sam's animatory state and location and update the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31034"></a>31034</td>
<td class="instruction">CALL <a class="link" href="60521.html">60521</a></td>
<td class="comment-11" rowspan="1">Make a walking sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31037"></a>31037</td>
<td class="instruction">CALL <a class="link" href="60032.html">60032</a></td>
<td class="comment-11" rowspan="1">Update the display</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31040"></a>31040</td>
<td class="instruction">CALL <a class="link" href="28357.html#28404">28404</a></td>
<td class="comment-11" rowspan="1">Update the message line</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31043"></a>31043</td>
<td class="instruction">LD HL,32712</td>
<td class="comment-11" rowspan="1"><a class="link" href="32712.html">32712</a> holds the value of the LSB of the system variable FRAMES as it was at the end of the last pass through the main loop (or this routine)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31046"></a>31046</td>
<td class="instruction">LD A,(23672)</td>
<td class="comment-11" rowspan="4">Wait about 240ms</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31049"></a>31049</td>
<td class="instruction">SUB (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31050"></a>31050</td>
<td class="instruction">CP 12</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31052"></a>31052</td>
<td class="instruction">JR C,31046</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31054"></a>31054</td>
<td class="instruction">ADD A,(HL)</td>
<td class="comment-11" rowspan="2">Store the current value of the LSB of the system variable FRAMES at <a class="link" href="32712.html">32712</a> for comparison next time</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31055"></a>31055</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31056"></a>31056</td>
<td class="instruction">JR 31008</td>
<td class="comment-11" rowspan="1">Jump back to the beginning of this loop</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31058"></a>
<div class="comments">
<div class="paragraph">
Sam is not midstride at the moment.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31058"></a>31058</td>
<td class="instruction">CALL <a class="link" href="29668.html">29668</a></td>
<td class="comment-11" rowspan="1">Show or hide the fuse, door, light bulb or phone in the icon panel</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31061"></a>31061</td>
<td class="instruction">CALL <a class="link" href="30972.html">30972</a></td>
<td class="comment-11" rowspan="1">Has the entire cutscene message been displayed yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31064"></a>31064</td>
<td class="instruction">JP NZ,<a class="link" href="61630.html">61630</a></td>
<td class="comment-11" rowspan="1">Jump if so to end the cutscene</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="31067"></a>
<div class="comments">
<div class="paragraph">
The cutscene is not over yet. Check whether Sam should turn round before pacing up or down again.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31067"></a>31067</td>
<td class="instruction">LD HL,58881</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 1 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31070"></a>31070</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31071"></a>31071</td>
<td class="instruction">DEC L</td>
<td class="comment-11" rowspan="1"><span class="register">L</span>=0</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31072"></a>31072</td>
<td class="instruction">AND 7</td>
<td class="comment-11" rowspan="1">Does Sam's x-coordinate divide 8 exactly?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31074"></a>31074</td>
<td class="instruction">JR NZ,31087</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31076"></a>31076</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is Sam facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31078"></a>31078</td>
<td class="instruction">JR NZ,31095</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31080"></a>31080</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31083"></a>31083</td>
<td class="instruction">XOR 128</td>
<td class="comment-11" rowspan="1">Flip bit 7 of Sam's animatory state, this turning him round</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31085"></a>31085</td>
<td class="instruction">JR 31031</td>
<td class="comment-11" rowspan="1">Jump back to update Sam's animatory state and the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31087"></a>31087</td>
<td class="instruction">CP 5</td>
<td class="comment-11" rowspan="1">Is Sam's x-coordinate congruent to 5 mod 8?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31089"></a>31089</td>
<td class="instruction">JR NZ,31095</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31091"></a>31091</td>
<td class="instruction">BIT 7,(HL)</td>
<td class="comment-11" rowspan="1">Is Sam facing right?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31093"></a>31093</td>
<td class="instruction">JR NZ,31080</td>
<td class="comment-11" rowspan="1">Jump back to turn Sam round if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="31095"></a>31095</td>
<td class="instruction">CALL <a class="link" href="59848.html">59848</a></td>
<td class="comment-11" rowspan="1">Update the SRB for Sam's current animatory state and location</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="31098"></a>31098</td>
<td class="instruction">JR 31028</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30972.html">30972</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30989">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="31100.html">31100</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>