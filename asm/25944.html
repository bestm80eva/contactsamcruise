<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 25944</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25918.html">25918</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25944">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25989.html">25989</a></span></td>
</tr>
</table>
<div class="description">25944: Determine Sam's location</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routines at <a class="link" href="28942.html">28942</a>, <a class="link" href="29072.html">29072</a> and <a class="link" href="29218.html">29218</a>. Returns with Sam's x-, y- and z-coordinates (adjusted appropriately if Sam is falling, rolling, somersaulting or being carried) in <span class="register">E</span>, <span class="register">D</span> and <span class="register">A</span>.
</div>
</div>
<table class="input-0">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>

</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25944"></a>25944</td>
<td class="instruction">LD DE,(58881)</td>
<td class="comment-11" rowspan="1">Collect Sam's x- and y-coordinates in <span class="register">E</span> and <span class="register">D</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25948"></a>25948</td>
<td class="instruction">LD A,(32764)</td>
<td class="comment-11" rowspan="1">Pick up Sam's status flags from <a class="link" href="32764.html">32764</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25951"></a>25951</td>
<td class="instruction">BIT 3,A</td>
<td class="comment-11" rowspan="1">Is Sam rolling or somersaulting?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25953"></a>25953</td>
<td class="instruction">JR NZ,25967</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25955"></a>25955</td>
<td class="instruction">AND 129</td>
<td class="comment-11" rowspan="1">Is Sam either being carried by a gangster or policeman, or falling from the roof of a building?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25957"></a>25957</td>
<td class="instruction">LD A,(58884)</td>
<td class="comment-11" rowspan="2">Return with <span class="register">A</span> holding Sam's z-coordinate if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25960"></a>25960</td>
<td class="instruction">RET Z</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25961"></a>
<div class="comments">
<div class="paragraph">
Sam is either being carried by a policeman, or falling from the roof of a building.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25961"></a>25961</td>
<td class="instruction">LD A,2</td>
<td class="comment-11" rowspan="1">2=behind people on the sidewalk</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25963"></a>25963</td>
<td class="instruction">LD DE,9896</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=38, <span class="register">E</span>=168 (out of reach)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25966"></a>25966</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="25967"></a>
<div class="comments">
<div class="paragraph">
Sam is rolling or somersaulting.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25967"></a>25967</td>
<td class="instruction">LD A,(58880)</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=Sam's animatory state</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25970"></a>25970</td>
<td class="instruction">AND 127</td>
<td class="comment-11" rowspan="1">Discard bit 7 (the direction bit)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25972"></a>25972</td>
<td class="instruction">CP 15</td>
<td class="comment-11" rowspan="1">Is Sam horizontal at the moment (animatory state <a class="link" href="../graphics/as.html#15">15</a> or <a class="link" href="../graphics/as.html#31">31</a>)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25974"></a>25974</td>
<td class="instruction">JR C,25978</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25976"></a>25976</td>
<td class="instruction">INC E</td>
<td class="comment-11" rowspan="2">Add 2 to Sam's x-coordinate if he's horizontal</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25977"></a>25977</td>
<td class="instruction">INC E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="25978"></a>25978</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=x+2 if Sam's horizontal, or x otherwise (where x is Sam's x-coordinate)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25979"></a>25979</td>
<td class="instruction">CALL <a class="link" href="60152.html#60165">60165</a></td>
<td class="comment-11" rowspan="1">Reset the carry flag if Sam is on or above the sidewalk, or set it if he's on or above the road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25982"></a>25982</td>
<td class="instruction">ADC A,34</td>
<td class="comment-11" rowspan="3"><span class="register">D</span>=34 if Sam's on or above the sidewalk, 35 if he's on or above the road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25984"></a>25984</td>
<td class="instruction">SUB E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25985"></a>25985</td>
<td class="instruction">LD D,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25986"></a>25986</td>
<td class="instruction">LD A,4</td>
<td class="comment-11" rowspan="1">4=outside</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="25988"></a>25988</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="25918.html">25918</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#25944">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="25989.html">25989</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>