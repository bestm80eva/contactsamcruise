<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 30627</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="Contact Sam Cruise" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30626.html">30626</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30627">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="30675.html">30675</a></span></td>
</tr>
</table>
<div class="description">30627: Check whether there is a telephone message for Sam</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="30675.html">30675</a>. On entry, <span class="register">A</span> holds the identifier of either the telephone that Sam is holding (which was ringing when he picked it up), or the telephone that Sam is calling. If there is a message for Sam, it will be queued unless Sam needs to identify himself first, in which case message <a class="link" href="27077.html">37</a> ('A VOICE SAID 'WHO'S THERE?'') will be queued instead. If there is no message for Sam, the message that is queued will depend on who Sam is calling (Daisy, the police, or someone else).
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Telephone identifier (see <a class="link" href="27392.html">27392</a>)</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc"><a class="link" href="27467.html">27467</a> or <a class="link" href="27506.html">27506</a></td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30627"></a>30627</td>
<td class="instruction">LD E,A</td>
<td class="comment-11" rowspan="1"><span class="register">E</span>=telephone identifier</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30628"></a>30628</td>
<td class="instruction">CALL <a class="link" href="30429.html#30442">30442</a></td>
<td class="comment-11" rowspan="1">Is the telephone ringing, or does the person on the other end have a message for Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30631"></a>30631</td>
<td class="instruction">JR C,30638</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30633"></a>30633</td>
<td class="instruction">INC HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the second byte of the entry in the phone table</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30634"></a>30634</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-11" rowspan="1">Pick this up in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30635"></a>30635</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Does Sam need to identify himself in order to receive the message?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30636"></a>30636</td>
<td class="instruction">JR Z,<a class="link" href="30575.html#30611">30611</a></td>
<td class="comment-11" rowspan="1">Jump if not to queue the message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30638"></a>30638</td>
<td class="instruction">LD (32663),HL</td>
<td class="comment-11" rowspan="1">Store at <a class="link" href="32663.html">32663</a> the address of either the second byte of the relevant phone table entry (if the phone was ringing, or the person Sam's calling has a message for him), or the final byte of the phone message table at <a class="link" href="27506.html">27506</a> (if the person Sam's calling has no message for him)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30641"></a>30641</td>
<td class="instruction">JP NC,<a class="link" href="30198.html">30198</a></td>
<td class="comment-11" rowspan="1">Jump if Sam must be asked to identify himself</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30644"></a>30644</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=telephone identifier</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30645"></a>30645</td>
<td class="instruction">CP 92</td>
<td class="comment-11" rowspan="1">92 is the identifier of Sam's telephone</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30647"></a>30647</td>
<td class="instruction">LD A,50</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="27271.html">50</a>: 'DAISY SAID 'NO MESSAGES SAM ''</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30649"></a>30649</td>
<td class="instruction">JR Z,30672</td>
<td class="comment-11" rowspan="1">Jump if Sam called his office</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30651"></a>30651</td>
<td class="instruction">LD A,E</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=telephone identifier</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30652"></a>30652</td>
<td class="instruction">CP 112</td>
<td class="comment-11" rowspan="1">112 is the identifier of the telephone in the police station</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30654"></a>30654</td>
<td class="instruction">JR NZ,30663</td>
<td class="comment-11" rowspan="1">Jump unless Sam called the police</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30656"></a>30656</td>
<td class="instruction">CALL <a class="link" href="31236.html">31236</a></td>
<td class="comment-11" rowspan="1">Send the police after Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30659"></a>30659</td>
<td class="instruction">LD A,51</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="27287.html">51</a>: 'A VOICE SAID 'OK CRUISE WE'RE COMING''</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30661"></a>30661</td>
<td class="instruction">JR 30672</td>
<td class="comment-11" rowspan="1">Queue this message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30663"></a>30663</td>
<td class="instruction">CALL <a class="link" href="61823.html">61823</a></td>
<td class="comment-11" rowspan="1">Get a random number in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30666"></a>30666</td>
<td class="instruction">AND 3</td>
<td class="comment-11" rowspan="1">Keep only bits 0 and 1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30668"></a>30668</td>
<td class="instruction">JR Z,30641</td>
<td class="comment-11" rowspan="1">Jump if the result is 0 (25% of the time): ask Sam 'WHO'S THERE?'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="30670"></a>30670</td>
<td class="instruction">ADD A,42</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a class="link" href="27150.html">43</a> (A VOICE SAID 'THERES NOONE HERE'), <a class="link" href="27165.html">44</a> (A VOICE SAID 'GET LOST - I'M TRYING TO SLEEP') or <a class="link" href="27193.html">45</a> (A VOICE SAID 'BE RIGHT WITH YOU')</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="30672"></a>30672</td>
<td class="instruction">JP <a class="link" href="30575.html#30617">30617</a></td>
<td class="comment-11" rowspan="1">Queue this message</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="30626.html">30626</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#30627">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="30675.html">30675</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20150417</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2015 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://skoolkit.ca/">SkoolKit</a> 4.3.</div>
</div>
</body>
</html>