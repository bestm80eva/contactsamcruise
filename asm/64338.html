<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 64338</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="64331.html">64331</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#64338">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="64512.html">64512</a></span></td>
</tr>
</table>
<div class="description">64338: Deal with a character who is about to step off the roof of a building</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
Used by the routine at <a class="link" href="60347.html">60347</a>. On entry, <span class="register">B</span> holds the value of the third byte of the character's location descriptor (see <a class="link" href="60179.html">60179</a>), which indicates the set of locations the character's current location belongs to:
</div>
<div class="paragraph">
<table class="default">
<tr>
<th><span class="register">B</span></th>
<th>Location(s) (x,y,z)</th>
</tr>
<tr>
<td class="centre" rowspan="3">2</td>
<td>(23,6,1)=right edge of the roof of the apartment building next to no. 74 (see <a class="link" href="50165.html">50165</a>)</td>
</tr>
<tr>
<td>(206,6,1)=right edge of the roof of the apartment building next to no. 19 (see <a class="link" href="50165.html">50165</a>)</td>
</tr>
<tr>
<td>(223,6,1)=left edge of the roof of no. 17 (see <a class="link" href="50048.html">50048</a>)</td>
</tr>
<tr>
<td class="centre" rowspan="4">3</td>
<td>(175,6,1)=left edge of the roof of the apartment building next to no. 19 (see <a class="link" href="49876.html">49876</a>)</td>
</tr>
<tr>
<td>(175,11,2)=left edge of the fire escape on the top floor of the apartment building next to no. 19 (see <a class="link" href="49876.html">49876</a>)</td>
</tr>
<tr>
<td>(175,17,2)=left edge of the fire escape on the 3rd floor of the apartment building next to no. 19 (see <a class="link" href="49876.html">49876</a>)</td>
</tr>
<tr>
<td>(175,23,2)=left edge of the fire escape on the 2nd floor of the apartment building next to no. 19 (see <a class="link" href="49876.html">49876</a>)</td>
</tr>
<tr>
<td class="centre">4</td>
<td>(124,5,1)=left edge of the roof of the police station (see <a class="link" href="48507.html">48507</a>)</td>
</tr>
<tr>
<td class="centre">5</td>
<td>(118,11,1)=right edge of the roof of no. 31 (see <a class="link" href="48501.html">48501</a>)</td>
</tr>
<tr>
<td class="centre">6</td>
<td>(177,28,2)=left edge of the fire escape on the 1st floor of the apartment building next to no. 19 (see <a class="link" href="49890.html#49898">49898</a>)</td>
</tr>
</table>
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Location indicator (2-6)</td>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-230)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64338"></a>64338</td>
<td class="instruction">CALL <a class="link" href="64512.html">64512</a></td>
<td class="comment-11" rowspan="1">Deal with the case where <span class="register">B</span>=2 and the character is standing on the edge of the roof of no. 17 or the apartment building next to no. 19</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64341"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="31476.html">31476</a> with <span class="register">H</span>=230 (Sam) and <span class="register">B</span>=1.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64341"></a>64341</td>
<td class="instruction">LD L,13</td>
<td class="comment-11" rowspan="2">Initialise byte 13 of the character's buffer to 0 on the assumption that he will land safely</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64343"></a>64343</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64345"></a>64345</td>
<td class="instruction">BIT 0,B</td>
<td class="comment-11" rowspan="1">Does <span class="register">B</span>=2, 4 or 6 (in which case the character will definitely land safely)?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64347"></a>64347</td>
<td class="instruction">JR Z,64354</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64349"></a>64349</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64350"></a>64350</td>
<td class="instruction">CP 230</td>
<td class="comment-11" rowspan="1">Are we dealing with Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64352"></a>64352</td>
<td class="instruction">RET NZ</td>
<td class="comment-11" rowspan="1">Return if not (characters other than Sam don't attempt dangerous leaps from the roofs of tall buildings)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64353"></a>64353</td>
<td class="instruction">INC (HL)</td>
<td class="comment-11" rowspan="1">Set byte 13 of Sam's buffer to 1 to indicate that he's stepping off or being dropped off the roof of a building from a great enough height that he could be knocked out when he lands (<span class="register">B</span>=1, 3 or 5)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64354"></a>64354</td>
<td class="instruction">DEC B</td>
<td class="comment-11" rowspan="1">Are we dealing with Sam being dropped off the roof of a building?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64355"></a>64355</td>
<td class="instruction">JR Z,64368</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64357"></a>64357</td>
<td class="instruction">LD A,B</td>
<td class="comment-11" rowspan="4">Point <span class="register">DE</span> at the appropriate landing y-coordinate in the data table at <a class="link" href="64326.html">64326</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64358"></a>64358</td>
<td class="instruction">ADD A,69</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64360"></a>64360</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64361"></a>64361</td>
<td class="instruction">LD D,251</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64363"></a>64363</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-11" rowspan="1">Collect the landing y-coordinate in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64364"></a>64364</td>
<td class="instruction">LD B,7</td>
<td class="comment-11" rowspan="1">Prepare to initialise byte 20 of the character's buffer to 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64366"></a>64366</td>
<td class="instruction">JR 64377</td>
<td class="comment-11" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64368"></a>
<div class="comments">
<div class="paragraph">
We are dealing with Sam being dropped off the roof of a building.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64368"></a>64368</td>
<td class="instruction">LD L,1</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=Sam's x-coordinate</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64370"></a>64370</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64371"></a>64371</td>
<td class="instruction">CALL <a class="link" href="60152.html#60165">60165</a></td>
<td class="comment-11" rowspan="1">Set the carry flag if there is no sidewalk beneath Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64374"></a>64374</td>
<td class="instruction">LD A,34</td>
<td class="comment-11" rowspan="2"><span class="register">A</span>=34 if Sam is above the sidewalk, 35 if he's above the road</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64376"></a>64376</td>
<td class="instruction">ADC A,B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64377"></a>
<div class="comments">
<div class="paragraph">
At this point <span class="register">A</span> holds the character's landing y-coordinate, and <span class="register">B</span> holds 0 (if the character is Sam and he's been dropped from the roof of a building) or 7 (if the character is voluntarily stepping off the roof).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64377"></a>64377</td>
<td class="instruction">LD L,20</td>
<td class="comment-11" rowspan="2">Set byte 20 of the character's buffer to 0 or 7</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64379"></a>64379</td>
<td class="instruction">LD (HL),B</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64380"></a>64380</td>
<td class="instruction">INC L</td>
<td class="comment-11" rowspan="2">Store the character's landing y-coordinate in byte 21 of his buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64381"></a>64381</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64382"></a>64382</td>
<td class="instruction">LD A,H</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64383"></a>64383</td>
<td class="instruction">CP 230</td>
<td class="comment-11" rowspan="1">Are we dealing with Sam?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64385"></a>64385</td>
<td class="instruction">JR Z,64398</td>
<td class="comment-11" rowspan="1">Jump if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64387"></a>64387</td>
<td class="instruction">LD L,15</td>
<td class="comment-11" rowspan="2">Remove the address of any interruptible subcommand routine from bytes 14 and 15 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64389"></a>64389</td>
<td class="instruction">LD (HL),0</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64391"></a>64391</td>
<td class="instruction">LD BC,64331</td>
<td class="comment-11" rowspan="3">Set the character's uninterruptible subcommand routine to <a class="link" href="64331.html">64331</a> and jump to it now</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64394"></a>64394</td>
<td class="instruction">PUSH BC</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64395"></a>64395</td>
<td class="instruction">JP <a class="link" href="63981.html">63981</a></td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64398"></a>
<div class="comments">
<div class="paragraph">
The remainder of this routine deals with Sam's descent from the roof of the building (either to the ground or to the roof of the neighbouring building).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64398"></a>64398</td>
<td class="instruction">LD A,128</td>
<td class="comment-11" rowspan="2">Set bit 7 of Sam's status flags at <a class="link" href="32764.html">32764</a>, indicating that he's falling from the roof of a building</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64400"></a>64400</td>
<td class="instruction">LD (32764),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64403"></a>
<div class="comments">
<div class="paragraph">
This entry point is used by the routine at <a class="link" href="29912.html">29912</a> when bit 7 at <a class="link" href="32764.html">32764</a> is set (by this routine - see above).
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64403"></a>64403</td>
<td class="instruction">CALL <a class="link" href="60521.html">60521</a></td>
<td class="comment-11" rowspan="1">Make a sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64406"></a>64406</td>
<td class="instruction">LD L,20</td>
<td class="comment-11" rowspan="2">Collect byte 20 of Sam's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64408"></a>64408</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64409"></a>64409</td>
<td class="instruction">AND A</td>
<td class="comment-11" rowspan="1">Is Sam falling straight downwards now?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64410"></a>64410</td>
<td class="instruction">JR NZ,64413</td>
<td class="comment-11" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64412"></a>64412</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=1</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64413"></a>64413</td>
<td class="instruction">LD L,8</td>
<td class="comment-11" rowspan="2">Set Sam's main action timer (in byte 8 of his buffer) to 1 if he's falling straight downwards now, or to the value of byte 20 of his buffer (1-7) if he's still moving left or right at the beginning of his descent</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64415"></a>64415</td>
<td class="instruction">LD (HL),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64416"></a>64416</td>
<td class="instruction">CALL <a class="link" href="64227.html">64227</a></td>
<td class="comment-11" rowspan="1">Move Sam to the next point in his descent</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64419"></a>64419</td>
<td class="instruction">JP C,<a class="link" href="60539.html#60547">60547</a></td>
<td class="comment-11" rowspan="1">Scroll the screen if necessary if Sam is still falling</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64422"></a>64422</td>
<td class="instruction">LD HL,0</td>
<td class="comment-11" rowspan="2">Set Sam's post-midstride y-coordinate (in byte 7 of his buffer) to 0 to indicate that he is neither midstride nor mid-action (which is redundant, because byte 7 will already be 0), and his main action timer (in byte 8) to 0 to indicate to the routine at <a class="link" href="29912.html">29912</a> that Sam has finished falling</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64425"></a>64425</td>
<td class="instruction">LD (58887),HL</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64428"></a>64428</td>
<td class="instruction">RET Z</td>
<td class="comment-11" rowspan="1">Return if Sam landed safely (without being knocked out)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64429"></a>
<div class="comments">
<div class="paragraph">
Sam has landed, and been knocked out by the fall.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64429"></a>64429</td>
<td class="instruction">CALL <a class="link" href="60032.html">60032</a></td>
<td class="comment-11" rowspan="1">Update the display</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64432"></a>64432</td>
<td class="instruction">CALL <a class="link" href="64618.html">64618</a></td>
<td class="comment-11" rowspan="1">Scroll the screen up and down a row 7 times (with accompanying sound effects)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64435"></a>64435</td>
<td class="instruction">LD H,230</td>
<td class="comment-11" rowspan="1">230=Sam</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64437"></a>64437</td>
<td class="instruction">CALL <a class="link" href="60293.html#60300">60300</a></td>
<td class="comment-11" rowspan="1">Make Sam stand up</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64440"></a>64440</td>
<td class="instruction">CALL <a class="link" href="64599.html">64599</a></td>
<td class="comment-11" rowspan="1">Hide the play area and clear the SRB</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64443"></a>64443</td>
<td class="instruction">CALL <a class="link" href="61823.html">61823</a></td>
<td class="comment-11" rowspan="3">Get a random number between 50 and 57 (ASCII codes for the digits 2-9) in <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64446"></a>64446</td>
<td class="instruction">AND 7</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64448"></a>64448</td>
<td class="instruction">ADD A,50</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64450"></a>64450</td>
<td class="instruction">LD (32720),A</td>
<td class="comment-11" rowspan="1">Store this at <a class="link" href="32720.html">32720</a></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64453"></a>64453</td>
<td class="instruction">SUB 48</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=N/10 (where N is the number of bucks Sam lost)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64455"></a>64455</td>
<td class="instruction">CALL <a class="link" href="28295.html">28295</a></td>
<td class="comment-11" rowspan="1">Adjust Sam's cash supply and print the new amount</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64458"></a>64458</td>
<td class="instruction">LD A,35</td>
<td class="comment-11" rowspan="1">Message <a class="link" href="27041.html">35</a>: ' WHEN I CAME TO MY WALLET WAS GONE...'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64460"></a>64460</td>
<td class="instruction">JP Z,<a class="link" href="31414.html#31445">31445</a></td>
<td class="comment-11" rowspan="1">Queue this message and show the ending cutscene if Sam has run out of money</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64463"></a>64463</td>
<td class="instruction">INC A</td>
<td class="comment-11" rowspan="1"><span class="register">A</span>=<a class="link" href="27057.html">36</a>: ' WHEN I CAME TO SOMEONE HAD TAKEN ${tens digit}0'</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64464"></a>64464</td>
<td class="instruction">CALL <a class="link" href="28357.html">28357</a></td>
<td class="comment-11" rowspan="1">Queue this message</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64467"></a>64467</td>
<td class="instruction">CALL <a class="link" href="31960.html">31960</a></td>
<td class="comment-11" rowspan="1">Take the hook and budgie from Sam (if he has them)</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="64470"></a>
<div class="comments">
<div class="paragraph">
Now we reveal the play area one row of tiles at a time from the bottom up, with accompanying sound effects.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64470"></a>64470</td>
<td class="instruction">LD HL,32608</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at one byte past the end of the <a class="link" href="32512.html">screen refresh buffer</a> (SRB), which is currently clear</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64473"></a>64473</td>
<td class="instruction">LD C,20</td>
<td class="comment-11" rowspan="1">There are 20 rows of the screen to reveal</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64475"></a>64475</td>
<td class="instruction">LD B,4</td>
<td class="comment-11" rowspan="4">Set every bit in a group of 4 bytes of the SRB, corresponding to one row of the screen</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64477"></a>64477</td>
<td class="instruction">DEC L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64478"></a>64478</td>
<td class="instruction">LD (HL),255</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64480"></a>64480</td>
<td class="instruction">DJNZ 64477</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64482"></a>64482</td>
<td class="instruction">PUSH BC</td>
<td class="comment-11" rowspan="1">Save the screen row counter (in <span class="register">C</span>)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64483"></a>64483</td>
<td class="instruction">PUSH HL</td>
<td class="comment-11" rowspan="1">Save the SRB pointer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64484"></a>64484</td>
<td class="instruction">LD A,100</td>
<td class="comment-11" rowspan="3"><span class="register">E</span>=100-<span class="register">L</span> (where <span class="register">L</span> is the LSB of the SRB address); this value determines the pitch of the sound effect</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64486"></a>64486</td>
<td class="instruction">SUB L</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64487"></a>64487</td>
<td class="instruction">LD E,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64488"></a>64488</td>
<td class="instruction">LD A,C</td>
<td class="comment-11" rowspan="5">Multiply <span class="register">C</span> (the screen row counter) by 8; this value determines the duration of the sound effect, and the border colour (0=black)</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64489"></a>64489</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64490"></a>64490</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64491"></a>64491</td>
<td class="instruction">ADD A,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64492"></a>64492</td>
<td class="instruction">LD C,A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64493"></a>64493</td>
<td class="instruction">XOR 16</td>
<td class="comment-11" rowspan="6">Make a sound effect with pitch and duration determined by the row of the screen that is being revealed</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64495"></a>64495</td>
<td class="instruction">OUT (254),A</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64497"></a>64497</td>
<td class="instruction">LD B,E</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="64498"></a>64498</td>
<td class="instruction">DJNZ 64498</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64500"></a>64500</td>
<td class="instruction">DEC C</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64501"></a>64501</td>
<td class="instruction">JR NZ,64493</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64503"></a>64503</td>
<td class="instruction">CALL <a class="link" href="60032.html">60032</a></td>
<td class="comment-11" rowspan="1">Reveal a row of the play area</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64506"></a>64506</td>
<td class="instruction">POP HL</td>
<td class="comment-11" rowspan="1">Restore the SRB pointer to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64507"></a>64507</td>
<td class="instruction">POP BC</td>
<td class="comment-11" rowspan="1">Restore the screen row counter to <span class="register">C</span></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64508"></a>64508</td>
<td class="instruction">DEC C</td>
<td class="comment-11" rowspan="1">Have we revealed all 20 rows yet?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64509"></a>64509</td>
<td class="instruction">JR NZ,64475</td>
<td class="comment-11" rowspan="1">Jump back to reveal the next row if not</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="64511"></a>64511</td>
<td class="instruction">RET</td>
<td class="comment-11" rowspan="1"></td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="64331.html">64331</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#64338">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="64512.html">64512</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20140614</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>