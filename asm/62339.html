<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html
    PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>Contact Sam Cruise: Routine at 62339</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../microsphere.css" />
<link rel="stylesheet" type="text/css" href="../csc.css" />

</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a class="link" href="../index.html"><img alt="logo" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="62325.html">62325</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#62339">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="62363.html">62363</a></span></td>
</tr>
</table>
<div class="description">62339: Control a character who is knocking on or opening a door (3)</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="4">
<div class="details">
<div class="paragraph">
The address of this interruptible subcommand routine is placed into bytes 14 and 15 of a character's buffer by the routine at <a class="link" href="62325.html">62325</a>. At this point, either the character has opened the door already (in which case this routine does nothing more than verify that the door is still open and then terminate the subcommand), or he is knocking on the door repeatedly (in which case he must be a policeman).
</div>
</div>
<table class="input-1">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">H</td>
<td class="register-desc">Character number (215-229)</td>
</tr>
</table>
<table class="output-0">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>

</table>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-2"><a name="62339"></a>62339</td>
<td class="instruction">LD L,0</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at byte 0 of the character's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62341"></a>62341</td>
<td class="instruction">BIT 2,(HL)</td>
<td class="comment-11" rowspan="1">Does the character have his arm raised?</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62343"></a>62343</td>
<td class="instruction">JR NZ,<a class="link" href="62325.html#62331">62331</a></td>
<td class="comment-11" rowspan="1">Make the character lower his arm if so</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62345"></a>62345</td>
<td class="instruction">LD D,H</td>
<td class="comment-11" rowspan="1"><span class="register">D</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62346"></a>62346</td>
<td class="instruction">CALL <a class="link" href="62099.html">62099</a></td>
<td class="comment-11" rowspan="1">Check whether the door is open</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62349"></a>62349</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1"><span class="register">H</span>=character number</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62350"></a>62350</td>
<td class="instruction">JP NZ,<a class="link" href="62080.html#62084">62084</a></td>
<td class="comment-11" rowspan="1">Terminate this subcommand if the door is open</td>
</tr>
<tr>
<td class="routine-comment" colspan="4">
<a name="62353"></a>
<div class="comments">
<div class="paragraph">
This character must be a policeman. In this case, he will knock repeatedly for a while, and then open the door by force if there's no answer.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62353"></a>62353</td>
<td class="instruction">LD L,16</td>
<td class="comment-11" rowspan="2">Decrement the counter in byte 16 of the policeman's buffer</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62355"></a>62355</td>
<td class="instruction">DEC (HL)</td>
<td class="comment-01" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62356"></a>62356</td>
<td class="instruction">JP NZ,<a class="link" href="62264.html#62268">62268</a></td>
<td class="comment-11" rowspan="1">Raise the policeman's arm for another knock if the counter has not reached zero</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62359"></a>62359</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-11" rowspan="1">Point <span class="register">HL</span> at the door status flags</td>
</tr>
<tr>
<td class="asm-label-0"></td>
<td class="address-1"><a name="62360"></a>62360</td>
<td class="instruction">JP <a class="link" href="62120.html#62131">62131</a></td>
<td class="comment-11" rowspan="1">Bust open the door</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev"><span class="prev-1">Prev: <a class="link" href="62325.html">62325</a></span></td>
<td class="up">Up: <a class="link" href="../maps/all.html#62339">Map</a></td>
<td class="next"><span class="next-1">Next: <a class="link" href="62363.html">62363</a></span></td>
</tr>
</table>
<div class="footer">
<div class="release">The complete Contact Sam Cruise RAM disassembly 20140614</div>
<div class="copyright">&#169; 1986 Microsphere Computer Services Ltd (Contact Sam Cruise). &#169; 2014 Richard Dymond (this disassembly).</div>
<div class="created">Created using <a class="link" href="http://pyskool.ca/?page_id=177">SkoolKit</a> 4.0.</div>
</div>
</body>
</html>